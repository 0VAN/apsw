<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux (vers 1 September 2005), see www.w3.org" />

  <title>APSW - Another Python SQLite Wrapper</title>
<style type="text/css">
/*<![CDATA[*/
body { 
  font-family: verdana, arial, helvetica, sans-serif;
  margin: 20px;
  background-color: #ffcc99;
  padding: 7px;
 }
/*]]>*/
</style>
</head>

<body>
  <h1 class="notoc">APSW - Another Python SQLite Wrapper</h1>

  <p><font size="-1">apsw-3.3.13-r1 18th February 2007</font></p>

  <p>APSW provides an SQLite 3 wrapper that provides the thinnest layer over
  <a href="http://www.sqlite.org">SQLite 3</a> possible. Everything you can do
  from the <a href="http://www.sqlite.org/capi3ref.html">C API</a> to SQLite 3,
  you can do from Python. Although APSW looks vaguely similar to the <a href=
  "http://www.python.org/peps/pep-0249.html">DBAPI</a>, it is <a href=
  "#dbapinotes">not compliant</a> with that API and instead works the way
  SQLite 3 does. (<a href="http://www.pysqlite.org">pysqlite</a> is DBAPI
  compliant - <a href="#pysqlitediffs">differences between apsw and pysqlite
  2</a>).</p>

  <blockquote>
    <p><b>Important changes in 3.3.10 release</b> You must explicitly call
    <a href="#Connection_class">close()</a> on Connection objects. If you do
    not call close then a detailed error message will be printed when
    Connection's destructor runs and cleanup will not happen of that
    connection. This is because it is not possible to raise Exceptions in
    destructors (actually it is, but Python just calls the destructor again
    which can result in an infinite loop). I did try to work around this, but
    with things like no control over which thread destructors run in, virtual
    tables, triggers, incomplete statements and SQLite's transaction control,
    it becomes impossible to cleanly close a connection if bits of code are
    returning errors. Using the close() method allows errors to be returned and
    it can be called again once they are fixed.</p>

    <p>All strings returned by APSW are now in Unicode. Previously strings that
    consisted only of ASCII characters where returned as the string type and
    other strings were returned as the unicode type. This did allow easy usage
    with other components that knew nothing of Unicode. However it could make
    Unicode aware software do more work.</p>
  </blockquote>

  <h1 class="notoc">Table of contents</h1>

  <table cellspacing="5" cellpadding="5">
    <tr>
      <td valign="top">
        <!--toc-->

        <ul>
          <li>
            <a href="#Download">Download</a>

            <ul>
              <li><a href="#Source">Source and binaries</a></li>

              <li><a href="#Sourcecode">Source code control</a></li>
            </ul>
          </li>

          <li><a href="#SQLiteVersionCompatibilityAndBenchmarking">SQLite
          version compatibility and benchmarking</a></li>

          <li><a href="#Example">Example</a></li>

          <li><a href="#Building">Building</a></li>

          <li>
            <a href="#APIReference">API Reference</a>

            <ul>
              <li><a href="#module-methods">Module methods</a></li>

              <li><a href="#Module_variables">Module variables</a></li>

              <li><a href="#Module_constants">Module constants</a></li>

              <li><a href="#Connection_class">Connection class</a></li>

              <li><a href="#Cursor">Cursor class</a></li>

              <li><a href="#VirtualTables">Virtual Tables</a></li>
            </ul>
          </li>

          <li>
            <a href="#Exceptions">Exceptions</a>

            <ul>
              <li><a href="#augmentedstacktraces">Augmented stack
              traces</a></li>
            </ul>
          </li>

          <li><a href="#Types">Types</a></li>

          <li><a href="#Unicode">Unicode</a></li>

          <li><a href="#threading">Multi-threading and re-entrancy</a></li>

          <li>
            <a href="#tracers">Tracing</a>

            <ul>
              <li><a href="#executiontracer">Execution Tracer</a></li>

              <li><a href="#rowtracer">Row Tracer</a></li>
            </ul>
          </li>

          <li><a href="#64bitpy25">64 bit hosts, Python 2.5</a></li>

          <li><a href="#executionmodel">Execution model</a></li>
        </ul>
      </td>

      <td valign="top">
        <ul>
          <li>
            <a href="#dbapinotes">DBAPI notes</a>

            <ul>
              <li><a href="#dbapimodiface">Module Interface</a></li>

              <li><a href="#dpapiconnectioniface">Connection Objects</a></li>

              <li><a href="#dbapicursoriface">Cursor Objects</a></li>

              <li><a href="#dpapitypes">Type objects</a></li>

              <li><a href="#dbapiextensions">Optional DB API
              Extensions</a></li>
            </ul>
          </li>

          <li><a href="#pysqlitediffs">pysqlite differences</a></li>

          <li><a href="#copyrightlicense">Copyright and License</a></li>

          <li>
            <a href="#verhistory">Version History</a>

            <ul>
              <li><a href="#3313r1">3.3.13-r1</a></li>

              <li><a href="#3310r1">3.3.10-r1</a></li>

              <li><a href="#339r1">3.3.9-r1</a></li>

              <li><a href="#338r1">3.3.8-r1</a></li>

              <li><a href="#337r1">3.3.7-r1</a></li>

              <li><a href="#335r1">3.3.5-r1</a></li>

              <li><a href="#327r1">3.2.7-r1</a></li>

              <li><a href="#322r1">3.2.2-r1</a></li>

              <li><a href="#321r1">3.2.1-r1</a></li>

              <li><a href="#313r1">3.1.3-r1</a></li>

              <li><a href="#308r3">3.0.8-r3</a></li>

              <li><a href="#308r2">3.0.8-r2</a></li>

              <li><a href="#308r1">3.0.8-r1</a></li>
            </ul>
          </li>
        </ul><!--endtoc-->
      </td>
    </tr>
  </table>

  <h1><a name="Download" id="Download">Download</a></h1>

  <h2><a name="Source" id="Source">Source and binaries</a></h2>

  <p>You can download this release in source or binary form.</p>

  <ul>
    <li><a href=
    "http://initd.org/pub/software/pysqlite/apsw/3.3.13-r1/apsw-3.3.13-r1.zip">apsw-3.3.13-r1.zip</a>
    (source)</li>

    <li><a href=
    "http://initd.org/pub/software/pysqlite/apsw/3.3.13-r1/apsw-3.3.13-r1.win32-py2.3.exe">
    apsw-3.3.13-r1.win32-py2.3.exe</a> (Windows Python 2.3)</li>

    <li><a href=
    "http://initd.org/pub/software/pysqlite/apsw/3.3.13-r1/apsw-3.3.13-r1.win32-py2.4.exe">
    apsw-3.3.13-r1.win32-py2.4.exe</a> (Windows Python 2.4)</li>

    <li><a href=
    "http://initd.org/pub/software/pysqlite/apsw/3.3.13-r1/apsw-3.3.13-r1.win32-py2.5.exe">
    apsw-3.3.13-r1.win32-py2.5.exe</a> (Windows Python 2.5)</li>
  </ul>

  <p>Some Linux distributions also have packages. Debian users can grab the
  package <a href="http://packages.debian.org/python-apsw">python-apsw</a>.
  Gentoo users can grab the package <a href=
  "http://www.gentoo-portage.com/dev-python/apsw">dev-python/apsw</a>.</p>

  <h2><a name="Sourcecode" id="Sourcecode">Source code control</a></h2>

  <p>The source is controlled by Subversion accessible as <a href=
  "http://initd.org/svn/pysqlite/apsw/trunk">http://initd.org/svn/pysqlite/apsw/trunk</a></p>

  <h1><a name="SQLiteVersionCompatibilityAndBenchmarking" id=
  "SQLiteVersionCompatibilityAndBenchmarking">SQLite version compatibility and
  benchmarking</a></h1>

  <p>APSW binds to the C interface of SQLite. That interface is stable for each
  major version of SQLite (ie the C interface for any SQLite 3.x is stable, but
  SQLite 4.x would be an incompatible change). Consequently you can use APSW
  against any revision of SQLite with the same major version number. There are
  small enhancements to the C api over time, and APSW adds support for them as
  appropriate. The version number of APSW covers the version these enhancements
  were added. The vast majority of changes to SQLite are in the SQL syntax and
  engine. Those will be picked up with any version of APSW. The one exception
  to this is experimental features in SQLite which may change API between
  revisions. Consequently you will need to turn them off if you want to work
  against a variety of versions of SQLite (see EXPERIMENTAL in
  <code>setup.py</code>). I strongly recommend you embed the SQLite library
  into APSW which will put you in control of versions.</p>

  <p>Before you do any benchmarking with APSW or other ways of accessing
  SQLite, you must understand how and when SQLite does transactions. See
  section 7.0, <i>Transaction Control At The SQL Level</i> of <a href=
  "http://sqlite.org/lockingv3.html">sqlite.org/lockingv3.html</a>. <b>APSW
  does not alter SQLite's behaviour with transactions.</b> Some access layers
  try to interpret your SQL and manage transactions behind your back, which may
  or may not work well with SQLite also do its own transactions. You should
  always manage your transactions yourself. For example to insert 1,000 rows
  wrap it in a single transaction else you will have 1,000 transactions. The
  best clue that you have one transaction per statement is having a maximum of
  60 statements per second. You need two drive rotations to do a transaction -
  the data has to be committed to the main file and the journal - and 7200 RPM
  drives do 120 rotations a second. On the other hand if you don't put in the
  transaction boundaries yourself and get more than 60 statements a second,
  then your access mechanism is silently starting transactions for you. This
  topic also comes up fairly frequently in the SQLite mailing list
  archives.</p>

  <h1><a name="Example" id="Example">Example</a></h1>

  <p>This is an example of how to use apsw, and also demonstrates all the
  features.</p>

  <blockquote>
    <pre>
<!--sourcestart-->
<font face="Lucida,Courier New"><font color=
"#C00000">import </font>os<font color="#0000C0">, </font>sys<font color=
"#0000C0">, </font>time
<font color="#C00000">import </font>apsw

<font color="#008000">###
### Check we have the expected version of apsw and sqlite
###

</font><font color="#C00000">print </font><font color=
"#004080">"Using APSW file"</font><font color=
"#0000C0">,</font>apsw<font color="#0000C0">.</font>__file__                <font color="#008000"># from the extension module
</font><font color="#C00000">print </font><font color=
"#004080">"   APSW version"</font><font color=
"#0000C0">,</font>apsw<font color="#0000C0">.</font>apswversion<font color=
"#0000C0">()           </font><font color="#008000"># from the extension module
</font><font color="#C00000">print </font><font color=
"#004080">" SQLite version"</font><font color=
"#0000C0">,</font>apsw<font color="#0000C0">.</font>sqlitelibversion<font color="#0000C0">()      </font><font color="#008000"># from the sqlite library code
</font><font color="#C00000">print </font><font color=
"#004080">" SQLite version"</font><font color=
"#0000C0">,</font>apsw<font color="#0000C0">.</font>SQLITE_VERSION_NUMBER   <font color="#008000"># from the sqlite header file at compile time

</font><font color="blue">   Using APSW file /space/apsw/apsw.so
      APSW version 3.3.13-r1
    SQLite version 3.4.0
    SQLite version 3004000
</font>
<font color="#008000">###
### Opening/creating database
###

</font><font color="#C00000">if </font>os<font color=
"#0000C0">.</font>path<font color="#0000C0">.</font>exists<font color=
"#0000C0">(</font><font color="#004080">"dbfile"</font><font color=
"#0000C0">): </font>os<font color="#0000C0">.</font>remove<font color=
"#0000C0">(</font><font color="#004080">"dbfile"</font><font color="#0000C0">)
</font>connection<font color="#0000C0">=</font>apsw<font color=
"#0000C0">.</font>Connection<font color="#0000C0">(</font><font color=
"#004080">"dbfile"</font><font color="#0000C0">)
</font>cursor<font color="#0000C0">=</font>connection<font color=
"#0000C0">.</font>cursor<font color="#0000C0">()

</font><font color="#008000">###
### simple statement
###

</font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"create table foo(x,y,z)"</font><font color="#0000C0">)

</font><font color="#008000">###
### multiple statements
###

</font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"insert into foo values(1,2,3); create table bar(a,b,c) ; insert into foo values(4, 'five', 6.0)"</font><font color="#0000C0">)

</font><font color="#008000">###
### iterator
###

</font><font color="#C00000">for </font>x<font color=
"#0000C0">,</font>y<font color="#0000C0">,</font>z <font color=
"#C00000">in </font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"select x,y,z from foo"</font><font color="#0000C0">):
    </font><font color="#C00000">print </font>cursor<font color=
"#0000C0">.</font>getdescription<font color="#0000C0">()  </font><font color=
"#008000"># shows column names and declared types
    </font><font color="#C00000">print </font>x<font color=
"#0000C0">,</font>y<font color="#0000C0">,</font>z

<font color="#008000">###        
### iterator - multiple statements
###

</font><font color="#C00000">for </font>m<font color=
"#0000C0">,</font>n<font color="#0000C0">,</font>o <font color=
"#C00000">in </font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"select x,y,z from foo ; select a,b,c from bar"</font><font color=
"#0000C0">):
    </font><font color="#C00000">print </font>m<font color=
"#0000C0">,</font>n<font color="#0000C0">,</font>o

<font color="#008000">###
### bindings - sequence
###

</font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"insert into foo values(?,?,?)"</font><font color=
"#0000C0">, (</font><font color="#0080C0">7</font><font color=
"#0000C0">, </font><font color="#004080">'eight'</font><font color=
"#0000C0">, </font>False<font color="#0000C0">))
</font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"insert into foo values(?,?,?1)"</font><font color=
"#0000C0">, (</font><font color="#004080">'one'</font><font color=
"#0000C0">, </font><font color="#004080">'two'</font><font color=
"#0000C0">))  </font><font color="#008000"># nb sqlite does the numbers from 1

###
### bindings - dictionary
###

</font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"insert into foo values(:alpha, :beta, :gamma)"</font><font color=
"#0000C0">, {</font><font color="#004080">'alpha'</font><font color=
"#0000C0">: </font><font color="#0080C0">1</font><font color=
"#0000C0">, </font><font color="#004080">'beta'</font><font color=
"#0000C0">: </font><font color="#0080C0">2</font><font color=
"#0000C0">, </font><font color="#004080">'gamma'</font><font color=
"#0000C0">: </font><font color="#004080">'three'</font><font color="#0000C0">})

</font><font color="#008000">###
### <a name="example-exectrace" id="example-exectrace">tracing execution</a> 
###

</font><font color="#C00000">def </font>mytrace<font color=
"#0000C0">(</font>statement<font color="#0000C0">, </font>bindings<font color=
"#0000C0">):
    </font><font color="#004080">"Called just before executing each statement"
    </font><font color="#C00000">print </font><font color=
"#004080">"SQL:"</font><font color="#0000C0">,</font>statement
    <font color="#C00000">if </font>bindings<font color="#0000C0">:
        </font><font color="#C00000">print </font><font color=
"#004080">"Bindings:"</font><font color="#0000C0">,</font>bindings
    <font color="#C00000">return </font>True  <font color=
"#008000"># if you return False then execution is aborted

</font>cursor<font color="#0000C0">.</font>setexectrace<font color=
"#0000C0">(</font>mytrace<font color="#0000C0">)
</font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"drop table bar ; create table bar(x,y,z); select * from foo where x=?"</font><font color="#0000C0">, (</font><font color="#0080C0">3</font><font color="#0000C0">,))

</font><font color="blue">   SQL: drop table bar ;
   SQL:  create table bar(x,y,z);
   SQL:  select * from foo where x=?
   Bindings: (3,)
</font>
<font color="#008000">###
### <a name="example-rowtrace" id="example-rowtrace">tracing results</a> 
###

</font><font color="#C00000">def </font>rowtrace<font color=
"#0000C0">(*</font>results<font color="#0000C0">):
    </font><font color=
"#004080">"""Called with each row of results before they are handed off.  You can return None to
    cause the row to be skipped or a different set of values to return"""
    </font><font color="#C00000">print </font><font color=
"#004080">"Row:"</font><font color="#0000C0">,</font>results
    <font color="#C00000">return </font>results

cursor<font color="#0000C0">.</font>setrowtrace<font color=
"#0000C0">(</font>rowtrace<font color="#0000C0">)
</font><font color="#C00000">for </font>row <font color=
"#C00000">in </font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"select x,y from foo where x&gt;3"</font><font color="#0000C0">):
     </font><font color="#C00000">pass

</font><font color="blue">   SQL: select x,y from foo where x&gt;3
   Row: (4, u'five')
   Row: (7, u'eight')
   Row: (u'one', u'two')
</font>
<font color="#008000"># Clear tracers
</font>cursor<font color="#0000C0">.</font>setrowtrace<font color=
"#0000C0">(</font>None<font color="#0000C0">)
</font>cursor<font color="#0000C0">.</font>setexectrace<font color=
"#0000C0">(</font>None<font color="#0000C0">)

</font><font color="#008000">###
### executemany
###

# (This will work correctly with multiple statements, as well as statements that
# return data.  The second argument can be anything that is iterable.)
</font>cursor<font color="#0000C0">.</font>executemany<font color=
"#0000C0">(</font><font color=
"#004080">"insert into foo (x) values(?)"</font><font color=
"#0000C0">, ( [</font><font color="#0080C0">1</font><font color=
"#0000C0">], [</font><font color="#0080C0">2</font><font color=
"#0000C0">], [</font><font color="#0080C0">3</font><font color="#0000C0">] ) )

</font><font color=
"#008000"># You can also use it for statements that return data
</font><font color="#C00000">for </font>row <font color=
"#C00000">in </font>cursor<font color="#0000C0">.</font>executemany<font color=
"#0000C0">(</font><font color=
"#004080">"select * from foo where x=?"</font><font color=
"#0000C0">, ( [</font><font color="#0080C0">1</font><font color=
"#0000C0">], [</font><font color="#0080C0">2</font><font color=
"#0000C0">], [</font><font color="#0080C0">3</font><font color="#0000C0">] ) ):
    </font><font color="#C00000">print </font>row

<font color="#008000">###
### defining your own functions
###

</font><font color="#C00000">def </font>ilove7<font color=
"#0000C0">(*</font>args<font color="#0000C0">):
    </font><font color="#004080">"a scalar function"
    </font><font color="#C00000">print </font><font color=
"#004080">"ilove7 got"</font><font color="#0000C0">,</font>args<font color=
"#0000C0">,</font><font color="#004080">"but I love 7"
    </font><font color="#C00000">return </font><font color="#0080C0">7

</font>connection<font color="#0000C0">.</font>createscalarfunction<font color=
"#0000C0">(</font><font color="#004080">"seven"</font><font color=
"#0000C0">, </font>ilove7<font color="#0000C0">)

</font><font color="#C00000">for </font>row <font color=
"#C00000">in </font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"select seven(x,y) from foo"</font><font color="#0000C0">):
    </font><font color="#C00000">print </font>row

<font color="#008000">###
### aggregate functions are more complex
###

# here we return the longest item when represented as a string

</font><font color="#C00000">def </font>longeststep<font color=
"#0000C0">(</font>context<font color="#0000C0">, *</font>args<font color=
"#0000C0">):
    </font><font color=
"#004080">"are any of the arguments longer than our current candidate"
    </font><font color="#C00000">for </font>arg <font color=
"#C00000">in </font>args<font color="#0000C0">:
        </font><font color="#C00000">if </font>len<font color=
"#0000C0">( </font>str<font color="#0000C0">(</font>arg<font color=
"#0000C0">) ) &gt; </font>len<font color="#0000C0">( </font>context<font color=
"#0000C0">[</font><font color="#004080">'longest'</font><font color=
"#0000C0">] ):
            </font>context<font color="#0000C0">[</font><font color=
"#004080">'longest'</font><font color="#0000C0">]=</font>str<font color=
"#0000C0">(</font>arg<font color="#0000C0">)

</font><font color="#C00000">def </font>longestfinal<font color=
"#0000C0">(</font>context<font color="#0000C0">):
    </font><font color="#004080">"return the winner"
    </font><font color="#C00000">return </font>context<font color=
"#0000C0">[</font><font color="#004080">'longest'</font><font color="#0000C0">]

</font><font color="#C00000">def </font>longestfactory<font color="#0000C0">():
    </font><font color=
"#004080">"""called for a new query.  The first item returned can be
    anything and is passed as the context to the step
    and final methods.  We use a dict."""
    </font><font color="#C00000">return </font><font color=
"#0000C0">( { </font><font color="#004080">'longest'</font><font color=
"#0000C0">: </font><font color="#004080">'' </font><font color=
"#0000C0">}, </font>longeststep<font color=
"#0000C0">, </font>longestfinal<font color="#0000C0">)

</font>connection<font color=
"#0000C0">.</font>createaggregatefunction<font color=
"#0000C0">(</font><font color="#004080">"longest"</font><font color=
"#0000C0">, </font>longestfactory<font color="#0000C0">)

</font><font color="#C00000">for </font>row <font color=
"#C00000">in </font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"select longest(x) from foo"</font><font color="#0000C0">):
    </font><font color="#C00000">print </font>row

<font color="#008000">###
### Defining collations.  
###

# The default sorting mechanisms don't understand numbers at the end of strings
# so here we define a collation that does

</font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"create table s(str)"</font><font color="#0000C0">)
</font>cursor<font color="#0000C0">.</font>executemany<font color=
"#0000C0">(</font><font color=
"#004080">"insert into s values(?)"</font><font color="#0000C0">,
                  ( [</font><font color="#004080">"file1"</font><font color=
"#0000C0">], [</font><font color="#004080">"file7"</font><font color=
"#0000C0">], [</font><font color="#004080">"file17"</font><font color=
"#0000C0">], [</font><font color="#004080">"file20"</font><font color=
"#0000C0">], [</font><font color="#004080">"file3"</font><font color=
"#0000C0">] ) )

</font><font color="#C00000">for </font>row <font color=
"#C00000">in </font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"select * from s order by str"</font><font color="#0000C0">):
    </font><font color="#C00000">print </font>row

</font><font color="blue">   (u'file1',)
   (u'file17',)
   (u'file20',)
   (u'file3',)
   (u'file7',)
</font>
<font color="#C00000">def </font>strnumcollate<font color=
"#0000C0">(</font>s1<font color="#0000C0">, </font>s2<font color="#0000C0">):
    </font><font color="#008000"># return -1 if s1&lt;s2, +1 if s1&gt;s2 else 0

    # split values into two parts - the head and the numeric tail
    </font>values<font color="#0000C0">=[</font>s1<font color=
"#0000C0">, </font>s2<font color="#0000C0">]
    </font><font color="#C00000">for </font>vn<font color=
"#0000C0">,</font>v <font color="#C00000">in </font>enumerate<font color=
"#0000C0">(</font>values<font color="#0000C0">):
        </font><font color="#C00000">for </font>i <font color=
"#C00000">in </font>range<font color="#0000C0">(</font>len<font color=
"#0000C0">(</font>v<font color="#0000C0">), </font><font color=
"#0080C0">0</font><font color="#0000C0">, -</font><font color=
"#0080C0">1</font><font color="#0000C0">):
            </font><font color="#C00000">if </font>v<font color=
"#0000C0">[</font>i<font color="#0000C0">-</font><font color=
"#0080C0">1</font><font color="#0000C0">] </font><font color=
"#C00000">not in </font><font color="#004080">"01234567890"</font><font color=
"#0000C0">:
                </font><font color="#C00000">break
        try</font><font color="#0000C0">:
            </font>v<font color="#0000C0">=( </font>v<font color=
"#0000C0">[:</font>i<font color="#0000C0">], </font>int<font color=
"#0000C0">(</font>v<font color="#0000C0">[</font>i<font color="#0000C0">:]) )
        </font><font color="#C00000">except </font>ValueError<font color=
"#0000C0">:
            </font>v<font color="#0000C0">=( </font>v<font color=
"#0000C0">[:</font>i<font color="#0000C0">], </font>None <font color=
"#0000C0">)
        </font>values<font color="#0000C0">[</font>vn<font color=
"#0000C0">]=</font>v
    <font color="#008000"># compare
    </font><font color="#C00000">if </font>values<font color=
"#0000C0">[</font><font color="#0080C0">0</font><font color=
"#0000C0">]&lt;</font>values<font color="#0000C0">[</font><font color=
"#0080C0">1</font><font color="#0000C0">]:
        </font><font color="#C00000">return </font><font color=
"#0000C0">-</font><font color="#0080C0">1
    </font><font color="#C00000">if </font>values<font color=
"#0000C0">[</font><font color="#0080C0">0</font><font color=
"#0000C0">]&gt;</font>values<font color="#0000C0">[</font><font color=
"#0080C0">1</font><font color="#0000C0">]:
        </font><font color="#C00000">return </font><font color="#0080C0">1
    </font><font color="#C00000">return </font><font color="#0080C0">0

</font>connection<font color="#0000C0">.</font>createcollation<font color=
"#0000C0">(</font><font color="#004080">"strnum"</font><font color=
"#0000C0">, </font>strnumcollate<font color="#0000C0">)

</font><font color="#C00000">for </font>row <font color=
"#C00000">in </font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"select * from s order by str collate strnum"</font><font color=
"#0000C0">):
    </font><font color="#C00000">print </font>row

<font color="blue">   (u'file1',)
   (u'file3',)
   (u'file7',)
   (u'file17',)
   (u'file20',)
</font>
<font color="#008000">###
### Authorizer (eg if you want to control what user supplied SQL can do)
###

</font><font color="#C00000">def </font>authorizer<font color=
"#0000C0">(</font>operation<font color="#0000C0">, </font>paramone<font color=
"#0000C0">, </font>paramtwo<font color=
"#0000C0">, </font>databasename<font color=
"#0000C0">, </font>triggerorview<font color="#0000C0">):
    </font><font color=
"#004080">"""Called when each operation is prepared.  We can return SQLITE_OK, SQLITE_DENY or
    SQLITE_IGNORE"""
    </font><font color="#008000"># find the operation name
    </font><font color="#C00000">print </font>apsw<font color=
"#0000C0">.</font>mapping_authorizer_function<font color=
"#0000C0">[</font>operation<font color="#0000C0">],
    </font><font color="#C00000">print </font>paramone<font color=
"#0000C0">, </font>paramtwo<font color=
"#0000C0">, </font>databasename<font color="#0000C0">, </font>triggerorview
    <font color="#C00000">if </font>operation<font color=
"#0000C0">==</font>apsw<font color=
"#0000C0">.</font>SQLITE_CREATE_TABLE <font color=
"#C00000">and </font>paramone<font color=
"#0000C0">.</font>startswith<font color="#0000C0">(</font><font color=
"#004080">"private"</font><font color="#0000C0">):
        </font><font color="#C00000">return </font>apsw<font color=
"#0000C0">.</font>SQLITE_DENY  <font color=
"#008000"># not allowed to create tables whose names start with private

    </font><font color="#C00000">return </font>apsw<font color=
"#0000C0">.</font>SQLITE_OK  <font color="#008000"># always allow

</font>connection<font color="#0000C0">.</font>setauthorizer<font color=
"#0000C0">(</font>authorizer<font color="#0000C0">)
</font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"insert into s values('foo')"</font><font color="#0000C0">)
</font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"select str from s limit 1"</font><font color="#0000C0">)

</font><font color="blue">   SQLITE_INSERT s None main None
   SQLITE_SELECT None None None None
   SQLITE_READ s str main None
</font>
<font color="#008000"># Cancel authorizer
</font>connection<font color="#0000C0">.</font>setauthorizer<font color=
"#0000C0">(</font>None<font color="#0000C0">)

</font><font color="#008000">###
### progress handler (SQLite 3 experimental feature)
###

# something to give us large numbers of random numbers
</font><font color="#C00000">import </font>random
<font color="#C00000">def </font>randomintegers<font color=
"#0000C0">(</font>howmany<font color="#0000C0">):
    </font><font color="#C00000">for </font>i <font color=
"#C00000">in </font>xrange<font color="#0000C0">(</font>howmany<font color=
"#0000C0">):
        </font><font color="#C00000">yield </font><font color=
"#0000C0">(</font>random<font color="#0000C0">.</font>randint<font color=
"#0000C0">(</font><font color="#0080C0">0</font><font color=
"#0000C0">,</font><font color="#0080C0">9999999999</font><font color=
"#0000C0">),)

</font><font color="#008000"># create a table with 500 random numbers
</font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"begin ; create table bigone(x)"</font><font color="#0000C0">)
</font>cursor<font color="#0000C0">.</font>executemany<font color=
"#0000C0">(</font><font color=
"#004080">"insert into bigone values(?)"</font><font color=
"#0000C0">, </font>randomintegers<font color="#0000C0">(</font><font color=
"#0080C0">500</font><font color="#0000C0">))
</font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color="#004080">"commit"</font><font color="#0000C0">)

</font><font color="#008000"># display an ascii spinner
</font>_phcount<font color="#0000C0">=</font><font color="#0080C0">0
</font>_phspinner<font color="#0000C0">=</font><font color="#004080">"|/-\\"
</font><font color="#C00000">def </font>progresshandler<font color=
"#0000C0">():
    </font><font color="#C00000">global </font>_phcount
    sys<font color="#0000C0">.</font>stdout<font color=
"#0000C0">.</font>write<font color="#0000C0">(</font>_phspinner<font color=
"#0000C0">[</font>_phcount<font color="#0000C0">%</font>len<font color=
"#0000C0">(</font>_phspinner<font color="#0000C0">)]+</font>chr<font color=
"#0000C0">(</font><font color="#0080C0">8</font><font color=
"#0000C0">)) </font><font color="#008000"># chr(8) is backspace
    </font>sys<font color="#0000C0">.</font>stdout<font color=
"#0000C0">.</font>flush<font color="#0000C0">()
    </font>_phcount<font color="#0000C0">+=</font><font color="#0080C0">1
    </font>time<font color="#0000C0">.</font>sleep<font color=
"#0000C0">(</font><font color="#0080C0">0.1</font><font color=
"#0000C0">) </font><font color=
"#008000"># deliberate delay so we can see the spinner (SQLite is too fast otherwise!)
    </font><font color="#C00000">return </font><font color=
"#0080C0">0  </font><font color="#008000"># returning non-zero aborts

# register progresshandler every 20 instructions
</font>connection<font color="#0000C0">.</font>setprogresshandler<font color=
"#0000C0">(</font>progresshandler<font color="#0000C0">, </font><font color=
"#0080C0">20</font><font color="#0000C0">)

</font><font color=
"#008000"># see it in action - sorting 500 numbers to find the biggest takes a while
</font><font color="#C00000">print </font><font color=
"#004080">"spinny thing -&gt; "</font><font color="#0000C0">,
</font><font color="#C00000">for </font>i <font color=
"#C00000">in </font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"select max(x) from bigone"</font><font color="#0000C0">):
    </font><font color="#C00000">print </font><font color="#008000"># newline
    </font><font color="#C00000">print </font>i <font color=
"#008000"># and the maximum number

</font>connection<font color="#0000C0">.</font>setprogresshandler<font color=
"#0000C0">(</font>None<font color="#0000C0">)

</font><font color="#008000">###
### commit hook (SQLite3 experimental feature)
###

</font><font color="#C00000">def </font>mycommithook<font color="#0000C0">():
    </font><font color="#C00000">print </font><font color=
"#004080">"in commit hook"
    </font>hour<font color="#0000C0">=</font>time<font color=
"#0000C0">.</font>localtime<font color="#0000C0">()[</font><font color=
"#0080C0">3</font><font color="#0000C0">]
    </font><font color="#C00000">if </font>hour<font color=
"#0000C0">&lt;</font><font color="#0080C0">8 </font><font color=
"#C00000">or </font>hour<font color="#0000C0">&gt;</font><font color=
"#0080C0">17</font><font color="#0000C0">:
        </font><font color="#C00000">print </font><font color=
"#004080">"no commits out of hours"
        </font><font color="#C00000">return </font><font color=
"#0080C0">1  </font><font color=
"#008000"># abort commits outside of 8am through 6pm
    </font><font color="#C00000">print </font><font color=
"#004080">"commits okay at this time"
    </font><font color="#C00000">return </font><font color=
"#0080C0">0  </font><font color="#008000"># let commit go ahead

</font>connection<font color="#0000C0">.</font>setcommithook<font color=
"#0000C0">(</font>mycommithook<font color="#0000C0">)
</font><font color="#C00000">try</font><font color="#0000C0">:
    </font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"begin; create table example(x,y,z); insert into example values (3,4,5) ; commit"</font><font color="#0000C0">)
</font><font color="#C00000">except </font>apsw<font color=
"#0000C0">.</font>ConstraintError<font color="#0000C0">:
    </font><font color="#C00000">print </font><font color=
"#004080">"commit was not allowed"

</font>connection<font color="#0000C0">.</font>setcommithook<font color=
"#0000C0">(</font>None<font color="#0000C0">)

</font><font color="#008000">###
### Virtual tables
###

# This virtual table stores information about files in a set of
# directories so you can execute SQL queries

</font><font color="#C00000">def </font>getfiledata<font color=
"#0000C0">(</font>directories<font color="#0000C0">):
    </font>columns<font color="#0000C0">=</font>None
    data<font color="#0000C0">=[]
    </font>counter<font color="#0000C0">=</font><font color="#0080C0">1
    </font><font color="#C00000">for </font>directory <font color=
"#C00000">in </font>directories<font color="#0000C0">:
        </font><font color="#C00000">for </font>f <font color=
"#C00000">in </font>os<font color="#0000C0">.</font>listdir<font color=
"#0000C0">(</font>directory<font color="#0000C0">):
            </font><font color="#C00000">if not </font>os<font color=
"#0000C0">.</font>path<font color="#0000C0">.</font>isfile<font color=
"#0000C0">(</font>os<font color="#0000C0">.</font>path<font color=
"#0000C0">.</font>join<font color="#0000C0">(</font>directory<font color=
"#0000C0">,</font>f<font color="#0000C0">)):
                </font><font color="#C00000">continue
            </font>counter<font color="#0000C0">+=</font><font color=
"#0080C0">1
            </font>st<font color="#0000C0">=</font>os<font color=
"#0000C0">.</font>stat<font color="#0000C0">(</font>os<font color=
"#0000C0">.</font>path<font color="#0000C0">.</font>join<font color=
"#0000C0">(</font>directory<font color="#0000C0">,</font>f<font color=
"#0000C0">))
            </font><font color="#C00000">if </font>columns <font color=
"#C00000">is </font>None<font color="#0000C0">:
                </font>columns<font color="#0000C0">=[</font><font color=
"#004080">"rowid"</font><font color="#0000C0">, </font><font color=
"#004080">"name"</font><font color="#0000C0">, </font><font color=
"#004080">"directory"</font><font color="#0000C0">]+[</font>x <font color=
"#C00000">for </font>x <font color="#C00000">in </font>dir<font color=
"#0000C0">(</font>st<font color="#0000C0">) </font><font color=
"#C00000">if </font>x<font color="#0000C0">.</font>startswith<font color=
"#0000C0">(</font><font color="#004080">"st_"</font><font color="#0000C0">)]
            </font>data<font color="#0000C0">.</font>append<font color=
"#0000C0">( [</font>counter<font color="#0000C0">, </font>f<font color=
"#0000C0">, </font>directory<font color=
"#0000C0">] + [</font>getattr<font color="#0000C0">(</font>st<font color=
"#0000C0">,</font>x<font color="#0000C0">) </font><font color=
"#C00000">for </font>x <font color="#C00000">in </font>columns<font color=
"#0000C0">[</font><font color="#0080C0">3</font><font color="#0000C0">:]] )
    </font><font color="#C00000">return </font>columns<font color=
"#0000C0">, </font>data

<font color="#008000"># This gets registered with the Connection
</font><font color="#C00000">class </font>Source<font color="#0000C0">:
    </font><font color="#C00000">def </font>Create<font color=
"#0000C0">(</font>self<font color="#0000C0">, </font>db<font color=
"#0000C0">, </font>modulename<font color="#0000C0">, </font>dbname<font color=
"#0000C0">, </font>tablename<font color="#0000C0">, *</font>args<font color=
"#0000C0">):
        </font>columns<font color="#0000C0">,</font>data<font color=
"#0000C0">=</font>getfiledata<font color="#0000C0">([</font>eval<font color=
"#0000C0">(</font>a<font color="#0000C0">) </font><font color=
"#C00000">for </font>a <font color="#C00000">in </font>args<font color=
"#0000C0">]) </font><font color="#008000"># eval strips off layer of quotes
        </font>schema<font color="#0000C0">=</font><font color=
"#004080">"create table foo("</font><font color="#0000C0">+</font><font color=
"#004080">','</font><font color="#0000C0">.</font>join<font color=
"#0000C0">([</font><font color="#004080">"'%s'" </font><font color=
"#0000C0">% (</font>x<font color="#0000C0">,) </font><font color=
"#C00000">for </font>x <font color="#C00000">in </font>columns<font color=
"#0000C0">[</font><font color="#0080C0">1</font><font color=
"#0000C0">:]])+</font><font color="#004080">")"
        </font><font color="#C00000">return </font>schema<font color=
"#0000C0">,</font>Table<font color="#0000C0">(</font>columns<font color=
"#0000C0">,</font>data<font color="#0000C0">)
    </font>Connect<font color="#0000C0">=</font>Create

<font color="#008000"># Represents a table
</font><font color="#C00000">class </font>Table<font color="#0000C0">:
    </font><font color="#C00000">def </font>__init__<font color=
"#0000C0">(</font>self<font color="#0000C0">, </font>columns<font color=
"#0000C0">, </font>data<font color="#0000C0">):
        </font>self<font color="#0000C0">.</font>columns<font color=
"#0000C0">=</font>columns
        self<font color="#0000C0">.</font>data<font color=
"#0000C0">=</font>data

    <font color="#C00000">def </font>BestIndex<font color=
"#0000C0">(</font>self<font color="#0000C0">, *</font>args<font color=
"#0000C0">):
        </font><font color="#C00000">return </font>None

    <font color="#C00000">def </font>Open<font color=
"#0000C0">(</font>self<font color="#0000C0">):
        </font><font color="#C00000">return </font>Cursor<font color=
"#0000C0">(</font>self<font color="#0000C0">)

    </font><font color="#C00000">def </font>Disconnect<font color=
"#0000C0">(</font>self<font color="#0000C0">):
        </font><font color="#C00000">pass

    </font>Destroy<font color="#0000C0">=</font>Disconnect

<font color="#008000"># Represents a cursor
</font><font color="#C00000">class </font>Cursor<font color="#0000C0">:
    </font><font color="#C00000">def </font>__init__<font color=
"#0000C0">(</font>self<font color="#0000C0">, </font>table<font color=
"#0000C0">):
        </font>self<font color="#0000C0">.</font>table<font color=
"#0000C0">=</font>table

    <font color="#C00000">def </font>Filter<font color=
"#0000C0">(</font>self<font color="#0000C0">, *</font>args<font color=
"#0000C0">):
        </font>self<font color="#0000C0">.</font>pos<font color=
"#0000C0">=</font><font color="#0080C0">0

    </font><font color="#C00000">def </font>Eof<font color=
"#0000C0">(</font>self<font color="#0000C0">):
        </font><font color="#C00000">return </font>self<font color=
"#0000C0">.</font>pos<font color="#0000C0">&gt;=</font>len<font color=
"#0000C0">(</font>self<font color="#0000C0">.</font>table<font color=
"#0000C0">.</font>data<font color="#0000C0">)

    </font><font color="#C00000">def </font>Rowid<font color=
"#0000C0">(</font>self<font color="#0000C0">):
        </font><font color="#C00000">return </font>self<font color=
"#0000C0">.</font>table<font color="#0000C0">.</font>data<font color=
"#0000C0">[</font>self<font color="#0000C0">.</font>pos<font color=
"#0000C0">][</font><font color="#0080C0">0</font><font color="#0000C0">]

    </font><font color="#C00000">def </font>Column<font color=
"#0000C0">(</font>self<font color="#0000C0">, </font>col<font color=
"#0000C0">):
        </font><font color="#C00000">return </font>self<font color=
"#0000C0">.</font>table<font color="#0000C0">.</font>data<font color=
"#0000C0">[</font>self<font color="#0000C0">.</font>pos<font color=
"#0000C0">][</font><font color="#0080C0">1</font><font color=
"#0000C0">+</font>col<font color="#0000C0">]

    </font><font color="#C00000">def </font>Next<font color=
"#0000C0">(</font>self<font color="#0000C0">):
        </font>self<font color="#0000C0">.</font>pos<font color=
"#0000C0">+=</font><font color="#0080C0">1

    </font><font color="#C00000">def </font>Close<font color=
"#0000C0">(</font>self<font color="#0000C0">):
        </font><font color="#C00000">pass

</font><font color="#008000"># Register the module as filesource
</font>connection<font color="#0000C0">.</font>createmodule<font color=
"#0000C0">(</font><font color="#004080">"filesource"</font><font color=
"#0000C0">, </font>Source<font color="#0000C0">())

</font><font color=
"#008000"># Arguments to module - all directories in sys.path
</font>sysdirs<font color="#0000C0">=</font><font color=
"#004080">","</font><font color="#0000C0">.</font>join<font color=
"#0000C0">([</font><font color="#004080">"'%s'" </font><font color=
"#0000C0">% (</font>x<font color="#0000C0">,) </font><font color=
"#C00000">for </font>x <font color="#C00000">in </font>sys<font color=
"#0000C0">.</font>path<font color="#0000C0">[</font><font color=
"#0080C0">1</font><font color="#0000C0">:] </font><font color=
"#C00000">if </font>len<font color="#0000C0">(</font>x<font color=
"#0000C0">) </font><font color="#C00000">and </font>os<font color=
"#0000C0">.</font>path<font color="#0000C0">.</font>isdir<font color=
"#0000C0">(</font>x<font color="#0000C0">)])
</font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"create virtual table sysfiles using filesource("</font><font color=
"#0000C0">+</font>sysdirs<font color="#0000C0">+</font><font color=
"#004080">")"</font><font color="#0000C0">)

</font><font color="#008000"># Which 3 files are the biggest?
</font><font color="#C00000">for </font>size<font color=
"#0000C0">,</font>directory<font color="#0000C0">,</font>file <font color=
"#C00000">in </font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"select st_size,directory,name from sysfiles order by st_size desc limit 3"</font><font color="#0000C0">):
    </font><font color="#C00000">print </font>size<font color=
"#0000C0">,</font>file<font color="#0000C0">,</font>directory

<font color="blue">   481008 unicodedata.so /usr/lib/python2.5/lib-dynload
   468240 atspi.so /var/lib/python-support/python2.5
   436907 libxml2.pyc /var/lib/python-support/python2.5
</font>
<font color="#008000"># Which 3 files are the oldest?
</font><font color="#C00000">for </font>ctime<font color=
"#0000C0">,</font>directory<font color="#0000C0">,</font>file <font color=
"#C00000">in </font>cursor<font color="#0000C0">.</font>execute<font color=
"#0000C0">(</font><font color=
"#004080">"select st_ctime,directory,name from sysfiles order by st_ctime limit 3"</font><font color="#0000C0">):
    </font><font color="#C00000">print </font>ctime<font color=
"#0000C0">,</font>file<font color="#0000C0">,</font>directory

<font color="blue">   1177864665.0 site.py /usr/lib/python2.5
   1177864679.0 debconf.py /usr/lib/python2.5/site-packages
   1177864688.0 debconf.pyc /usr/lib/python2.5/site-packages
</font>
<font color="#008000">###
### Cleanup
###

# We must close connections
</font>connection<font color="#0000C0">.</font>close<font color=
"#0000C0">(</font>True<font color="#0000C0">)  </font><font color=
"#008000"># force it since we want to exit</font>
<!--sourceend-->
</pre>
  </blockquote>

  <h1><a name="Building" id="Building">Building</a></h1>

  <p>The simple way is:</p>

  <blockquote>
    <pre>
python setup.py install
</pre>
  </blockquote>

  <p>On Windows the above command uses Visual C++. You can use MinGW with the
  command below. (If MinGW complains about missing Python functions starting
  with <code>_imp__Py_</code> then run <code>mingwsetup.bat</code> which will
  ensure your Python distribution is initialized for MinGW compilation).</p>

  <blockquote>
    <pre>
python setup.py build --compile=mingw32 install
</pre>
  </blockquote>

  <p>By default whatever SQLite 3 you already have on your system is used. If
  you place a copy of the headers and library in a <code>sqlite3</code>
  subdirectory then that will be used instead. It is highly recommended that
  you build SQLite into APSW. Here is a quick and easy way of doing everything
  on Linux/Mac or Windows with MinGW, including the SQLite library statically
  into the extension (ie no external DLLs/shared libraries will be needed at
  runtime). You should follow these instructions with your current directory
  being where you extracted the APSW source to.</p>

  <blockquote>
    <p>Download the <a href="http://www.sqlite.org/download.html">SQLite 3
    code</a>.</p>

    <dl>
      <dt><b>Windows</b><br />
      Get the processed .zip</dt>

      <dd>
        <pre>
&gt; mkdir sqlite3
&gt; cd sqlite3
&gt; unzip sqlite-source-3_3_10.zip
&gt; del tclsqlite.c
&gt; gcc -DTHREADSAFE -DNDEBUG -O3 -c *.c
&gt; ar r libsqlite3.a *.o
&gt; ranlib libsqlite3.a
&gt; cd ..
&gt; python setup.py build --compile=mingw32 install
&gt; python -c "import apsw ; print  apsw.sqlitelibversion(), apsw.apswversion()"
</pre>
      </dd>

      <dt><b>Mac/Linux/etc</b><br />
      Get the normal source.</dt>

      <dd>
        <pre>
$ wget http://www.sqlite.org/sqlite-3.3.13.tar.gz
$ tar xvfz sqlite-3.3.13.tar.gz
$ mv sqlite-3.3.13 sqlite3
$ cd sqlite3
<font color=
"blue"># The static library is not built for inclusion into a seperate shared library
# by default.  If using gcc, then do this</font>
$ env CC="gcc -fPIC" CFLAGS="-DHAVE_DLOPEN" ./configure --enable-threadsafe --disable-tcl
<font color="blue"># otherwise do this</font>
$ env CFLAGS="-DHAVE_DLOPEN" ./configure --enable-threadsafe --disable-tcl
<font color=
"blue"># The <tt>CFLAGS="-DHAVE_DLOPEN</tt> bit is needed for loading dynamic
# extensions.  See SQLite bug <a href=
"http://www.sqlite.org/cvstrac/tktview?tn=2082">2082</a></font>
$ make
$ cp .libs/*.a .
$ ranlib *.a
$ cd ..
$ python setup.py install
$ python -c "import apsw ; print  apsw.sqlitelibversion(), apsw.apswversion()"      
</pre>
      </dd>
    </dl>
  </blockquote>

  <p>The extension just turns into a single file apsw.so (Linux/Mac) or
  apsw.pyd (Windows). You don't need to install it and can drop it into any
  directory that is more convenient for you and that your code can reach. To
  just do the build and not install, leave out <code>install</code> from the
  lines above and add <code>build</code> if it isn't already there.</p>

  <p>If you want to check that your build is correct then you can run the unit
  tests. Run <tt>tests.py</tt>. It will print the APSW file used, APSW and
  SQLite versions and then run lots of tests all of which should pass.</p>

  <h1><a name="APIReference" id="APIReference">API Reference</a></h1>

  <p>Everything you can do from the <a href=
  "http://www.sqlite.org/capi3ref.html">SQLite 3 C API</a> you can do from
  Python. The documentation below notes which C API functions are called where
  you can get further details on what happens. The only C function not
  implemented is <a href=
  "http://www.sqlite.org/capi3ref.html#sqlite3_collation_needed">sqlite3_collation_needed</a>.
  (You can still add collations, you just can't use this function to find out
  about them on-demand.) Additionally <a href=
  "http://www.sqlite.org/capi3ref.html#sqlite3_trace">sqlite3_trace</a> is not
  wrapped but instead <a href="#tracers">tracers</a> are provided that have
  more functionality.</p>

  <p>Some functions are marked experimental in the SQLite API. These have also
  been made available, but as the SQLite documentation notes these functions
  may change form or disappear in future versions of SQLite. You can exclude
  these functions by commenting out the relevant line in the
  <code>setup.py</code> when building aspw.</p>

  <p>Various methods create functions, collations and set various hooks and
  handlers. To remove the relevant function/collation/hook/handler, pass in
  None as the callable method.</p>

  <h2><a name="module-methods" id="module-methods">Module methods</a></h2>

  <dl>
    <dt><strong>sqlitelibversion()</strong></dt>

    <dd>
      <p>Returns the version of the SQLite library as a string. This function
      calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_libversion">sqlite3_libversion</a>.</p>
    </dd>

    <dt><strong>apswversion()</strong></dt>

    <dd>
      <p>Returns the version of the APSW module.</p>
    </dd>

    <dt><strong>enablesharedcache(boolean)</strong></dt>

    <dd>
      <p>Calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_enable_shared_cache">sqlite3_enable_shared_cache</a>.
      This sets the <a href="http://www.sqlite.org/sharedcache.html">shared
      cache mode</a> which was introduced in SQLite 3.3. Note that it only
      affects the current thread and should be called before any databases are
      opened. If called after that then you'll get MisuseError. APSW already
      enforces the other conditions required to use this functionality, namely
      that all operations on a Connection must happen in the same thread.
      Consequently you can safely use this functionality. You do not need to
      worry about <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_thread_cleanup">sqlite3_thread_cleanup</a>
      as that is only needed when abnormally terminating a thread (something
      you can't do in Python). Python's normal reference counting ensures all
      objects are cleaned up, and SQLite automatically cleans up the shared
      cache when the last Connection in a thread is closed.</p>
    </dd>

    <dt><strong>createmodule("modulename", module_object)</strong></dt>

    <dd>
      <p>Registers a virtual table. See <a href="#VirtualTables">virtual
      tables</a> for more details.</p>
    </dd>
  </dl>

  <h2><a name="Module_variables" id="Module_variables">Module
  variables</a></h2>

  <dl>
    <dt><strong>connection_hooks</strong></dt>

    <dd>
      <p>The purpose of the hooks is to allow the easy registration of
      functions, virtual tables or similar items with each Connection as it is
      created. The default value is an empty list. Whenever a Connection is
      created, each item in <code>apsw.connection_hooks</code> is invoked with
      a single parameter being the new Connection object. If the hook raises an
      exception then the creation of the Connection fails.</p>
    </dd>
  </dl>

  <h2><a name="Module_constants" id="Module_constants">Module
  constants</a></h2>

  <p>Note that the same values can be used in different contexts. For example
  SQLITE_OK and SQLITE_CREATE_INDEX both have a value of zero. For each group
  of constants there is also a mapping (dict) available that you can supply a
  string to and get the corresponding numeric value, or supply a numeric value
  and get the corresponding string. These can help improve diagnostics/logging,
  calling other modules etc. For example</p>

  <blockquote>
    <pre>
apsw.mapping_authorizer_function["SQLITE_READ"]=20
apsw.mapping_authorizer_function[20]="SQLITE_READ"
</pre>
  </blockquote>

  <dl>
    <dt><strong>SQLITE_VERSION_NUMBER</strong></dt>

    <dd>
      <p>This is the version of the SQLite library from the header file
      <tt>sqlite3.h</tt> at apsw compile time. It is expressed as an integer
      (eg 3003010 for SQLite 3.3.10).</p>
    </dd>

    <dt><strong>SQLITE_OK, SQLITE_DENY, SQLITE_IGNORE</strong></dt>

    <dd>
      <p>These values are returned from authorizer functions. Mapping is
      <code>apsw.mapping_authorizer_return</code></p>
    </dd>

    <dt><strong>SQLITE_CREATE_INDEX, SQLITE_CREATE_TABLE</strong> and 30
    others</dt>

    <dd>
      <p>The values are passed to authorizer functions. You can see a complete
      list in the <a href=
      "http://sqlite.org/capi3ref.html#sqlite3_set_authorizer">sqlite3_set_authorizer
      documentation</a>. Mapping is
      <code>apsw.mapping_authorizer_function</code></p>
    </dd>

    <dt><strong>SQLITE_INDEX_CONSTRAINT_EQ, SQLITE_INDEX_CONSTRAINT_GT</strong>
    and 4 others</dt>

    <dd>
      <p>These values are passed to the BestIndex method of <a href=
      "#VirtualTables">virtual tables</a>. Mapping is
      <code>apsw.mapping_bestindex_constraints</code></p>
    </dd>

    <dt><strong>SQLITE_IOERR_READ, SQLITE_IOERR_FSYNC</strong> and 7
    others</dt>

    <dd>
      <p>These are <a href=
      "http://www.sqlite.org/cvstrac/wiki?p=ExtendedResultCodes">extended
      result codes</a> which are provided in <a href=
      "#Exceptions">exceptions</a>. Mapping is
      <code>apsw.mapping_extended_result_codes</code></p>
    </dd>

    <dt><strong>SQLITE_OK, SQLITE_ERROR, SQLITE_PERM</strong> and 22
    others</dt>

    <dd>
      <p>These are <a href=
      "http://sqlite.org/capi3ref.html#result-codes">SQLite result codes</a>
      which are provided in <a href="#Exceptions">exceptions</a>. Mapping is
      <code>apsw.mapping_result_codes</code></p>
    </dd>
  </dl>

  <h2><a name="Connection_class" id="Connection_class">Connection
  class</a></h2>

  <p>The connection class wraps a <code>sqlite3 pointer</code>.</p>

  <dl>
    <dt><strong>Connection(filename)</strong></dt>

    <dd>
      <p>Opens an SQLite database named <code>filename</code>. (This calls
      <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_open">sqlite3_open</a>
      behind the scenes. You must call close when finished with a Connection.
      If you do not call close then the destructor will invoke
      <code>sys.excepthook</code> which by default will print a traceback.</p>
    </dd>

    <dt><strong>close(force=False)</strong></dt>

    <dd>
      <p>You must call this method when you are done with a Connection. Behind
      the scenes it calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_close">sqlite3_close</a>. It
      is ok to call this method multiple times. Note that this method can raise
      an exception. Some examples of when exceptions are raised:</p>

      <ul>
        <li>You have statements still executing (ie currently positioned at a
        row). Statements that have consumed all results will not hold up
        closing a Connection.</li>

        <li>You were in the middle of a transaction. SQLite will attempt to do
        a rollback and errors in your rollback hook will be passed back.</li>

        <li>Any virtual tables will be dropped/disconnected. Errors in your
        Disconnect/Destroy methods will be passed back.</li>
      </ul>

      <p>If <tt>force</tt> is True, then any executing cursors are forcibly
      closed.</p>
    </dd>

    <dt><strong>cursor()</strong></dt>

    <dd>
      <p>Creates a new <a href="#Cursor">cursor</a> object on this
      database.</p>
    </dd>

    <dt><strong>changes()</strong></dt>

    <dd>
      <p>This function returns the number of database rows that were changed
      (or inserted or deleted) by the most recently completed INSERT, UPDATE,
      or DELETE statement. (This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_changes">sqlite3_changes</a>.
      Read that link for some additional notes.)</p>
    </dd>

    <dt><strong>totalchanges()</strong></dt>

    <dd>
      <p>This function returns the total number of database rows that have be
      modified, inserted, or deleted since the database connection was opened.
      (This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_total_changes">sqlite3_total_changes</a>.
      Read that link for some additional notes.)</p>
    </dd>

    <dt><strong>last_insert_rowid()</strong></dt>

    <dd>
      <p>Returns the integer key of the most recent insert in the database.
      (This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_last_insert_rowid">sqlite3_last_insert_rowid</a>.)</p>
    </dd>

    <dt><strong>complete(statement)</strong></dt>

    <dd>
      <p>Calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_complete">sqlite3_complete</a>
      which tells you if the input string comprises one or more complete SQL
      statements.</p>
    </dd>

    <dt><strong>setbusytimeout(milliseconds)</strong></dt>

    <dd>
      <p>Sets the busy timeout. (This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_busy_timeout">sqlite3_busy_timeout</a>).</p>
    </dd>

    <dt><strong>setbusyhandler(callable)</strong></dt>

    <dd>
      <p>Sets the busy handler to callable. callable will be called with one
      integer argument which is the number of prior calls to the busy callback
      for the same lock. If the busy callback returns something that evaluates
      to False, then SQLite returns SQLITE_BUSY to the calling code.. If the
      callback returns something that evaluates to True, then SQLite tries to
      open the table again and the cycle repeats. (This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_busy_handler">sqlite3_busy_handler</a>).</p>
    </dd>

    <dt><strong>interrupt()</strong></dt>

    <dd>
      <p>Causes any pending operations on the database to abort at the earliest
      opportunity. You can call this from any thread. (This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_interrupt">sqlite3_interrupt</a>).</p>
    </dd>

    <dt><strong>createscalarfunction(name, callable, numargs=-1)</strong></dt>

    <dd>
      <p>Registers a scalar function. The callable will be called. You can
      specify how many arguments your function takes as the numargs parameter
      or supply -1 to take any amount. (This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_create_function">sqlite3_create_function</a>).</p>
    </dd>

    <dt><strong>createaggregatefunction(name, factorycallback,
    numargs=-1)</strong></dt>

    <dd>
      <p>Registers an aggregate function. (This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_create_function">sqlite3_create_function</a>.)
      You can specify how many arguments your function takes as the numargs
      parameter or supply -1 to take any amount. When the function is called by
      an SQL query, the factorycallback is called without any arguments. The
      factorycallback needs to return a tuple consisting of three 3 items.</p>

      <ul>
        <li>
          <p>a context object (of any type)</p>
        </li>

        <li>
          <p>a step function which is called for each row. The context object
          will be the first parameter, and the remaining parameters will be
          from the SQL statement. The return value is ignored - you supply it
          in final.</p>
        </li>

        <li>
          <p>a final function which is called at the end. The only parameter
          will be the context object. The value returned is set as the return
          for the function. It must be a valid SQLite type. Note that the final
          function is always called even if an exception was raised by the step
          function. This allows you to ensure any resources are cleaned up.</p>
        </li>
      </ul>
    </dd>

    <dt><strong>createcollation(name, callable)</strong></dt>

    <dd>
      <p>Creates a collation with the specified name and callable. The callable
      will be passed two string arguments. It should return -1 if the first is
      less than the second, 0 if they are equal and 1 and if the first is
      greater than the second. Note that this controls sorting (ORDER BY in
      SQL) so your comparisons don't affect other SQL operations. Read more
      about <a href="http://www.sqlite.org/datatype3.html#collation">SQLite's
      handling of collations.</a> (This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_create_collation">sqlite3_create_collation</a>.)
      If there is an error in your Python code then 0 (ie items are equal) is
      returned.</p>
    </dd>

    <dt><strong>setauthorizer(callable)</strong></dt>

    <dd>
      <p>The callable is invoked while SQL statements are being prepared. The
      intent is to allow applications to safely execute user entered SQL. The
      callable is called with 5 parameters:</p>

      <ul>
        <li>
          <p>an integer representing the operation (the constants are available
          on the apsw module - eg <code>apsw.SQLITE_CREATE_TABLE</code>.</p>
        </li>

        <li>
          <p>A string (or None) dependent on the operation</p>
        </li>

        <li>
          <p>Another string (or None) dependent on the operation</p>
        </li>

        <li>
          <p>The string name of the database (or None)</p>
        </li>

        <li>
          <p>Name of the innermost trigger or view doing the access (or
          None)</p>
        </li>
      </ul>

      <p>You should return <code>apsw.SQLITE_OK</code> to allow the operation
      or <code>apsw.SQLITE_DENY</code> or <code>apsw.SQLITE_IGNORE</code> as
      applicable. (SQLITE_DENY is returned if there is an error in your Python
      code).</p>

      <p>This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_set_authorizer">sqlite3_set_authorizer</a>
      which contains more detailed documentation.</p>
    </dd>

    <dt><strong>setupdatehook(callable)</strong></dt>

    <dd>
      <p>Sets a callable which is invoked during data changing. The callable
      takes four parameters:</p>

      <ul>
        <li>An integer whose value is one of apsw.SQLITE_INSERT,
        apsw.SQLITE_DELETE or apsw.SQLITE_UPDATE</li>

        <li>A string naming the database on which the operation is happening.
        (This will typically be <tt>main</tt> unless you used <a href=
        "http://sqlite.org/lang_attach.html"><tt>ATTACH</tt></a></li>

        <li>A string naming the table on which the operation is happening.</li>

        <li>An integer with the rowid of the row that is changing.</li>
      </ul>

      <p>(This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_update_hook">sqlite3_update_hook</a>.)</p>
    </dd>

    <dt><strong>setrollbackhook(callable)</strong></dt>

    <dd>
      <p>Sets a callable which is invoked during a rollback. The callable takes
      no parameters and the return value is ignored. (This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_rollback_hook">sqlite3_rollback_hook</a>.)</p>
    </dd>

    <dt><strong>setcommithook(callable)</strong> (SQLite 3 experimental
    feature)</dt>

    <dd>
      <p>Sets a callable which is invoked just before a commit. It should
      return zero for the commit to go ahead and non-zero for it to be turned
      into a rollback. In the case of an exception in your callable, a non-zero
      (ie rollback) value is returned. (This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_commit_hook">sqlite3_commit_hook</a>.)</p>
    </dd>

    <dt><strong>setprofile(callable)</strong> (SQLite 3 experimental
    feature)</dt>

    <dd>
      <p>Sets a callable which is invoked at the end of execution of each
      statement and passed the statement string and how long it took to
      execute. (The execution time appears to be in nanoseconds.) Note that it
      is called only on completion. If for example you do a <tt>SELECT</tt> and
      only read the first result, then you won't reach the end of the
      statement.</p>

      <p>(This calls <tt>sqlite3_profile</tt> which is not documented on the
      SQLite web site. See the <tt>sqlite3.h</tt> header file for
      documentation.).</p>
    </dd>

    <dt><strong>setprogresshandler(callable, nsteps=20)</strong> (SQLite 3
    experimental feature)</dt>

    <dd>
      <p>Sets a callable which is invoked every <i>nsteps</i> SQLite
      inststructions. The callable should return a non-zero value to abort or
      zero to continue. (If there is an error in your Python callable then
      non-zero will be returned). (This calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_progress_handler">sqlite3_progress_handler</a>
      which has more detailed documentation).</p>
    </dd>

    <dt><strong>enableloadextension(bool)</strong> (SQLite 3 experimental
    feature)</dt>

    <dd>
      <p>Enables <a href=
      "http://www.sqlite.org/cvstrac/wiki/wiki?p=LoadableExtensions">extension</a>
      loading which is disabled by default. Calls
      sqlite3_enable_load_extension. See note below about enabling extension
      loading.</p>
    </dd>

    <dt><strong>loadextension(filename, entrypoint=None)</strong> (SQLite 3
    experimental feature)</dt>

    <dd>
      <p>Loads an <a href=
      "http://www.sqlite.org/cvstrac/wiki/wiki?p=LoadableExtensions">extension</a>
      by calling sqlite3_load_extension. If you don't specify the entrypoint
      then SQLite uses a default of sqlite3_extension_init.</p>

      <p>Note that if you build SQLite on Unix then extension loading won't be
      built into SQLite by default. The details are in SQLite ticket <a href=
      "http://www.sqlite.org/cvstrac/tktview?tn=2082">2082</a>. You need to
      edit <tt>setup.py</tt> if you enable extension loading.</p>
    </dd>
  </dl>

  <h2><a name="Cursor" id="Cursor">Cursor class</a></h2>

  <p>The Cursor class creates and executes SQLite prepared statements.</p>

  <dl>
    <dt><strong>Cursor()</strong></dt>

    <dd>
      <p>You cannot create cursors directly. The are created by calling
      Connection.cursor().</p>
    </dd>

    <dt><strong>close(force=False)</strong></dt>

    <dd>
      <p>In general cursors are in a closed state, and you won't need to call
      this method. Calling while the cursor is already closed or if the
      Connection is closed will not result in errors. An open Cursor prevents
      closing of Connections. The circumstances in which they are not closed
      include:</p>

      <ul>
        <li>You haven't requested all the rows of available data (calling
        next() or using the cursor as an iterator will return more data)</li>

        <li>You got a recoverable error and can try again (eg SQLITE_BUDY)</li>

        <li >
          If force is False then you will get exceptions if there is
          remaining work to do be in the Cursor such as more statements to
          execute, more data from the executemany binding sequence etc. If
          force is True then all remaining work and state information will be
          discarded.
        </li>
      </ul>
    </dd>

    <dt><strong>getconnection()</strong></dt>

    <dd>
      <p>Returns the <a href="#Connection">Connection</a> object to which this
      cursor belongs.</p>
    </dd>

    <dt><strong>execute(statements, bindings=())</strong></dt>

    <dd>
      <p>Executes the statements using the supplied bindings. The bindings can
      be supplied as a tuple or as a dict. Execution returns when the first row
      is available or all statements have completed. The cursor object is
      returned which you can use as an iterator. (See <a href=
      "#executionmodel">execution model</a> for more details. This function
      wraps <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_prepare">sqlite3_prepare</a>
      and <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_step">sqlite3_step</a>.)</p>
    </dd>

    <dt><strong>executemany(statements, sequenceofbindings=())</strong></dt>

    <dd>
      <p>Repeatedly executes statements using each element of
      sequenceofbindings for the bindings each time. Execution returns when the
      first row is available or all statements have completed. The cursor
      object is returned which you can use as an iterator. (See <a href=
      "#executionmodel">execution model</a> for more details. This function
      runs in a loop on each member of sequenceofbindings and wraps <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_prepare">sqlite3_prepare</a>
      and <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_step">sqlite3_step</a>
      .)</p>
    </dd>

    <dt><strong>next()</strong></dt>

    <dd>
      <p>The Cursor object is an iterator, and so you can use it in a for loop
      or similar situations. You can also explicitly call the
      <code>next()</code> method. This method returns a tuple of the contents
      of a returned row or raises StopIteration after all returned rows have
      been seen.</p>
    </dd>

    <dt><strong>getdescription()</strong></dt>

    <dd>
      <p>Returns a list describing each column in the current result set. Each
      item is a tuple of (column name, declared column type). You should only
      call this function while data is being returned such as when
      <code>next()</code> returns a row. This function calls <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_column_name">sqlite3_column_name</a>
      and <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_column_decltype">sqlite3_column_decltype</a>.</p>
    </dd>

    <dt><strong>setexectrace(callable)</strong><br />
    <strong>setrowtrace(callable)</strong><br />
    <strong>getexectrace()</strong><br />
    <strong>getrowtrace()</strong></dt>

    <dd>
      <p>Sets or gets the <a href="#tracers">tracers</a>.</p>
    </dd>
  </dl>

  <h2><a name="VirtualTables" id="VirtualTables">Virtual Tables</a></h2>

  <p><a href="http://www.sqlite.org/cvstrac/wiki?p=VirtualTables">Virtual
  Tables</a> are a new experimental feature introduced in SQLite 3.3.7 and
  updated in 3.3.8. They let a developer provide underlying table
  implementations, while still presenting a normal SQL interface to the user.
  The person writing SQL doesn't need to know or care that some of the tables
  come from elsewhere.</p>

  <p>Some examples of how you might use this:</p>

  <ul>
    <li>Translating to/from information stored in other formats (eg a csv/ini
    format file)</li>

    <li>Accessing the data remotely (eg you could make a table that backends
    into <a href="http://www.josephson.org/projects/pyamazon/">Amazon's
    API</a></li>

    <li>Dynamic information (eg currently running processes, files and
    directories, objects in your program)</li>

    <li>Information that needs reformatting (eg if you have complex rules about
    how to convert strings to/from Unicode in the dataset)</li>

    <li>Information that isn't relationally correct (eg if you have data that
    has ended up with duplicate "unique" keys with code that dynamically
    corrects it)</li>

    <li>There are other examples on the <a href=
    "http://www.sqlite.org/cvstrac/wiki?p=VirtualTables">SQLite page</a></li>
  </ul>

  <p>You need to have 3 types of object. A module, a virtual table and a
  cursor. These are documented below. You can also read the <a href=
  "http://www.sqlite.org/cvstrac/wiki?p=VirtualTableMethods">SQLite C method
  documentation</a>. At the C, they are just one set of methods. At the
  Python/apsw level, they are split over the 3 types of object. The leading
  <tt><i>x</i></tt> is ommitted in Python. You can return SQLite error codes
  (eg <code>SQLITE_READONLY</code>) by raising the appropriate exceptions (eg
  <code>apsw.ReadOnlyError</code>).</p>

  <h3>Module</h3>

  <p>The module is used to create the virtual tables. Once you have a module
  object, you register it with a connection by calling
  <code>Connection.createmodule("modulename", module_object)</code>. To create
  the table, you use SQL: <code>CREATE <b>VIRTUAL</b> TABLE tablename USING
  modulename<i>(arg0, arg1, ...)</i></code></p>

  <dl>
    <dt><strong>Create(connection, modulename, databasename, tablename,
    *args)</strong></dt>

    <dd>
      <p>This is called when a table is first created on a connection. The
      optional args are passed from the SQL CREATE statement.</p>

      <p><b>Return</b> two items. The first item should be a string with SQL
      specifying the schema for the table. The second item is an Object that
      implements the table methods. Later methods in the Table and Cursor
      objects will reference the columns by number, starting at zero with
      column -1 being the rowid. Every row must have a unique unchanging
      integer rowid up to 64bit signed integer.</p>
    </dd>

    <dt><strong>Connect(connection, modulename, databasename, tablename,
    *args)</strong></dt>

    <dd>
      <p>Similar to Create, except it is called to establish a new connection
      to an existing table. The paramaters and return are the same. In general
      Create is called the first time a table is accessed and is where you are
      expect to do heavy initialisation work. Connect can take that initialized
      work and reuse it.</p>
    </dd>
  </dl>

  <h3>Table</h3>

  <p>The table contains knowledge of the indices, makes cursors and can perform
  transactions.</p>

  <dl>
    <dt><strong>Begin() Sync() Commit() Rollback()</strong> (optional)</dt>

    <dd>
      <p>These functions are used as part of transactions. At the time of
      writing they are undocumented in SQLite (see <a href=
      "http://www.sqlite.org/cvstrac/wiki?p=VirtualTableMethods">www.sqlite.org/cvstrac/wiki?p=VirtualTableMethods</a>.
      They do not take any arguments nor return anything. You do not have to
      provide these methods.</p>
    </dd>

    <dt><strong>Disconnect()</strong> (optional)<br />
    <strong>Destroy()</strong></dt>

    <dd>
      <p>These methods are the opposite of <code>Connect</code> and
      <code>Create</code> in the module implementation. They can be considered
      destructors for the virtual table instance. It is currently unclear how
      SQLite behaves if you return an error (<a href=
      "http://www.sqlite.org/cvstrac/tktview?tn=2099">ticket 2099</a>). Note
      that SQLite does ignore errors in the Disconnect method. If you do have
      one, you will get an exception from the <code>close()</code> method, but
      the database will actually be closed.</p>
    </dd>

    <dt><strong>Open()</strong></dt>

    <dd>
      <p>Returns a new cursor object.</p>
    </dd>

    <dt><strong>FindFunction(nfuncargs, funcname)</strong> <i>not implemented
    yet</i></dt>

    <dd>
      <p>Lets you provide an alternate function implementation for the table.
      This is currently not implemented in apsw because of incomplete
      information in SQLite to make it safe (<a href=
      "http://www.sqlite.org/cvstrac/tktview?tn=2095">ticket 2095</a>).</p>
    </dd>

    <dt><strong>UpdateDeleteRow(rowid)</strong></dt>

    <dd>
      <p>Requests deletion of the row with the specified id.</p>

      <p><b>Return</b> None (ignored)</p>
    </dd>

    <dt><strong>UpdateInsertRow(rowid, fields)</strong></dt>

    <dd>
      <p>Create a new row. fields is a tuple the same size as the number of
      columns in your table containing a value for each column. rowid is the
      rowid to give the row. If rowid is None then you must make up a rowid you
      want.</p>

      <p><b>Return</b> the new rowid (if rowid was None), else ignored</p>
    </dd>

    <dt><strong>UpdateChangeRow(rowid, newrowid, fields)</strong></dt>

    <dd>
      <p>Change an existing row of the table with the values in fields. fields
      is a tuple the same size as the number of columns in your table
      containing a value for each column. If newrowid is not the same as rowid
      then you also have to change the rowid (this would happen for a query
      like <code>UPDATE table SET rowid=rowid+100 WHERE ...</code>)</p>

      <p><b>Return</b> None (ignored)</p>
    </dd>

    <dt><strong>BestIndex(constraints, orderbys)</strong></dt>

    <dd>
      <blockquote>
        This is a complex method and even has its <a href=
        "http://www.sqlite.org/cvstrac/wiki?p=VirtualTableBestIndexMethod">own
        page</a> in the SQLite documentation. To get going initially, just
        return <code>None</code> and you will be fine. Implementing this method
        reduces the number of rows scanned in your table to satisfy queries,
        but only if you have an index or index like mechanism available.

        <p><b>Note</b> The implementation of this method differs slightly from
        the <a href=
        "http://www.sqlite.org/cvstrac/wiki?p=VirtualTableBestIndexMethod">SQLite
        documentation</a> for the C API. You are not passed "unusable"
        constraints. The argv/constraintarg positions are not off by one. In
        the C api, you have to return position 1 to get something passed to
        Filter in position 0. With the APSW implementation, you return position
        0 to get Filter arg 0, position 1 to get Filter arg 1 etc.</p>
      </blockquote>

      <p>The purpose of this method is to ask if you have the ability to
      determine if a row meets certain constraints that doesn't involve
      visiting every row. An example constraint is
      <code>price&nbsp;&gt;&nbsp;74.99</code>. In a traditional SQL database,
      queries with constraints can be speeded up <a href=
      "http://www.sqlite.org/lang_createindex.html">with indices</a>. If you
      return None, then SQLite will visit every row in your table and evaluate
      the constraint itself. Your index choice returned from BestIndex will
      also be passed to the Filter method on your cursor object. Note that
      SQLite may call this method multiple times trying to find the most
      efficient way of answering a query. You will be passed the contraints as
      a sequence of tuples containing two items. The first item is the column
      number and the second item is the operation.</p>

      <blockquote>
        Example query: <code>select * from foo where price&gt;74.99 and
        quantity&lt;=10 and customer=="Acme Widgets"</code>.

        <p>If customer is column 0, price column 2 and quantity column 5, then
        constraints will be:</p>
        <pre>
   (2, apsw.SQLITE_INDEX_CONSTRAINT_GT),
   (5, apsw.SQLITE_INDEX_CONSTRAINT_LE),
   (0, apsw.SQLITE_INDEX_CONSTRAINT_EQ)
</pre>

        <p>Note that you do not get the value of the constraint (eg "Acme
        Widgets", 74.99 and 10 in this example).</p>
      </blockquote>

      <p>The first item you return is None if you don't have an appropriate
      index for any of the constraints and SQLite should iterate over every
      row. If you do have a suitable index then you return as the first item a
      sequence the same length as constraints with the members mapping to the
      constraints in order. Each item can be one of None, an integer or a tuple
      of an integer and a boolean.</p>

      <dl>
        <dt>None</dt>

        <dd>This means you have no index for that constraint. SQLite will have
        to iterate over every row for it.</dd>

        <dt>integer</dt>

        <dd>This is the argument number for the constraintargs being passed
        into the Filter function of your cursor (the values "Acme Widgets",
        74.99 and 10 in the example).</dd>

        <dt>(integer, boolean)</dt>

        <dd>By default SQLite will check what you return. For example if you
        said that you had an index on price, SQLite will still check that each
        row you returned is greater than 74.99. If you set the boolean to False
        then SQLite won't do that double checking.</dd>
      </dl>

      <blockquote>
        Example query: <code>select * from foo where price&gt;74.99 and
        quantity&le;10 and customer=="Acme Widgets"</code>.

        <p>Customer is column 0, price column 2 and quantity column 5. You can
        index on customer equality and price.</p>

        <table border="1" cellspacing="5" cellpadding="5">
          <tr>
            <th>Constraints (in)</th>

            <th>Constraints used (out)</th>
          </tr>

          <tr>
            <td valign="top">
              <pre>
   (2, apsw.SQLITE_INDEX_CONSTRAINT_GT),
   (5, apsw.SQLITE_INDEX_CONSTRAINT_LE),
   (0, apsw.SQLITE_INDEX_CONSTRAINT_EQ)
</pre>
            </td>

            <td valign="top">
              <pre>
   1,
   None,
   0
</pre>
            </td>
          </tr>
        </table>
      </blockquote>

      <p>When your Filter method in the cursor is called, constraintarg[0] will
      be "Acme Widgets" (customer constraint value) and constraintarg[1] will
      be 74.99 (price constraint value). You can also return an index number
      (integer) and index string to use (SQLite attaches no significance to
      these values - they are passed as is to your Cursor.Filter method as a
      way for the BestIndex method to let the Cursor.Filter method know which
      of your indices or similar mechanism to use.</p>

      <p>The second argument to BestIndex is a sequence of orderbys because the
      query requested the results in a <a href=
      "http://sqlite.org/lang_select.html">certain order</a>. If your data is
      already in that order then SQLite can give the results back as is. If
      not, then SQLite will have to sort the results first.</p>

      <blockquote>
        Example query: <code>select * from foo order by price desc, quantity
        asc</code>

        <p>Price is column 2, quantity column 5 so orderbys will be:</p>
        <pre>
  (2, True),  <font color=
"blue"># True means descending, False is ascending</font>
  (5, False)
</pre>
        <pre>

</pre>
      </blockquote>

      <p><b>Return</b> You should return up to 5 items. Items not present in
      the return have a default value.</p>

      <dl>
        <dt>0: constraints used (default None)</dt>

        <dd>This must either be None or a sequence the same length as
        constraints passed in. Each item should be as specified above saying if
        that constraint is used, and if so which constraintarg to make the
        value be in your Cursor.Filter function.</dd>

        <dt>1: index number (default zero)</dt>

        <dd>This value is passed as is to Cursor.Filter</dd>

        <dt>2: index string (default None)</dt>

        <dd>This value is passed as is to Cursor.Filter</dd>

        <dt>3: orderby consumed (default False)</dt>

        <dd>Return True if your output will be in exactly the same order as the
        orderbys passed in</dd>

        <dt>4: estimated cost (default a huge number)</dt>

        <dd>Approximately how many disk operations are needed to provide the
        results. SQLite uses the cost to optimise queries. For example if the
        query includes <code>A or B</code> and A has 2,000 operations and B has
        100 then it is best to evaluate B before A.</dd>
      </dl>

      <blockquote>
        A complete example. Query is <code>select * from foo where
        price&gt;74.99 and quantity&lt;=10 and customer=="Acme Widgets" order
        by price desc, quantity asc</code>

        <p>Customer is column 0, price column 2 and quantity column 5. You can
        index on customer equality and price.</p>
        <pre>
<b>BestIndex</b>(constraints, orderbys)
 
<b>constraints</b>= ( (2, apsw.SQLITE_INDEX_CONSTRAINT_GT), 
                  (5, apsw.SQLITE_INDEX_CONSTRAINT_LE), 
                  (0, apsw.SQLITE_INDEX_CONSTRAINT_EQ)  )

<b>orderbys</b>= ( (2, True), (5, False) )
</pre>

        <p>You return</p>
        <pre>
( (1, None, 0),   <font color="blue"># constraints used</font>
  27,             <font color="blue"># index number</font>
  "idx_pr_cust",  <font color="blue"># index name</font>
  False,          <font color="blue"># results are not in orderbys order</font>
  1000            <font color=
"blue"># about 1000 disk operations to access index</font>
)
</pre>

        <p>Your Cursor.Filter method will be called with:</p>
        <pre>
27,              <font color="blue"># index number you returned</font>
"idx_pr_cust",   <font color="blue"># index name you returned</font>
"Acme Widgets",  <font color="blue"># constraintarg[0] - customer</font>  
74.99            <font color="blue"># constraintarg[1] - price </font>
</pre>
      </blockquote>

      <h3>Cursor</h3>

      <p>Cursors are created by the Open method in the table object. They
      iterate over rows returning desired values.</p>

      <dl>
        <dt><strong>Close()</strong></dt>

        <dd>
          <p>This is the destructor for the cursor. Note that you must cleanup.
          The method will not be called again if you raise an exception.</p>

          <p><b>Return</b> None (ignored)</p>
        </dd>

        <dt><strong>Filter(indexnum, indexstring, constraintargs)</strong></dt>

        <dd>
          <p>This method is always called first to initialize an iteration to
          the first row of the table. The arguments come from the BestIndex
          method in the table object with constraintargs being a tuple of the
          constraints you requested. If you always return None in BestIndex
          then indexnum will be zero, indexstring will be None and
          constraintargs will be empty).</p>

          <p><b>Return</b> None (ignored)</p>
        </dd>

        <dt><strong>Eof()</strong></dt>

        <dd>
          <p>Called to ask if we are at the end of the table. It is called
          after each call to Filter and Next.</p>

          <p><b>Return</b> True if the cursor is at a valid row of data, else
          False. Note that if you have an exception in this method, or do not
          provide it then False will be returned to SQLite.</p>
        </dd>

        <dt><strong>Next()</strong></dt>

        <dd>
          <p>Advance to the next row in the table.</p>

          <p><b>Return</b> None (ignored)</p>
        </dd>

        <dt><strong>Rowid()</strong></dt>

        <dd>
          <p><b>Return</b> the current rowid. This should be an integer up to
          64 bits signed.</p>
        </dd>

        <dt><strong>Column(number)</strong></dt>

        <dd>
          <p>Requests the value of the specified column number. Column
          numbering starts at zero with -1 being the rowid.</p>

          <p><b>Return</b> the value in that column. It must be compatible with
          SQLite types (ie one of None, integer, float, string or buffer
          (blob))</p>
        </dd>
      </dl>

      <h3>Troubleshooting virtual tables</h3>

      <p>Virtual Tables are a very recent addition to SQLite and haven't been
      widely used yet. They do work well if all your routines work
      perfectly.</p>

      <p>A big help is using the local variables recipe as described in
      <a href="#augmentedstacktraces">augmented stack traces</a> which will
      give you more details in errors. You may also find errors compounding.
      For example if you have an error in the Filter method of a cursor, SQLite
      then closes the cursor. If you also return an error in the Close method
      then the first error may mask the second or vice versa.</p>

      <p>Also note that SQLite may ignore responses from your methods if they
      don't make sense. For example in BestIndex, if you set multiple arguments
      to have the same constraintargs position then your Filter won't receive
      any constraintargs at all.</p>

      <h1><a name="Exceptions" id="Exceptions">Exceptions</a></h1>

      <p>All exception types have <code>apsw.Error</code> as a parent. The
      following exceptions can happen:</p>

      <dl>
        <dt>ThreadingViolationError</dt>

        <dd>
          <p>You have used an object allocated in one thread in a different
          thread. All objects (Connection, Cursor) must be used in the same
          thread they were allocated in.</p>
        </dd>

        <dt>IncompleteExecutionError</dt>

        <dd>
          <p>You have tried to start a new SQL execute call before executing
          all the previous ones. See the <a href="#executionmodel">execution
          model</a> for more details.</p>
        </dd>

        <dt>ConnectionNotClosedError</dt>

        <dd>
          <p>The destructor for a Connection was called, but close() hadn't
          been called on the Connection. Destructors aren't allowed to return
          exceptions, so what actually happens is that
          <code>sys.excepthook</code> is called with this exception so you can
          find where it is happening in your code. The database will also be
          left open and hence leak memory and potentially file descriptors.</p>
        </dd>

        <dt>ConnectionClosedError</dt>

        <dd>
          <p>You have called close() on a Connection and then continued to use
          it.</p>
        </dd>

        <dt>BindingsError</dt>

        <dd>
          <p>There is an incorrect number of bindings when using tuples. Or you
          supplied a dictionary of bindings and not all bindings were named in
          the SQL statement. For example
          <code>select&nbsp;*&nbsp;from&nbsp;foo&nbsp;where&nbsp;x=:name&nbsp;and&nbsp;y=?</code>.
          You should either use colon name style or question mark style in a
          query but not both.</p>

          <p><b>Note</b> It is not considered an error to have missing keys in
          a dictionary. For example <code>cursor.execute("insert into foo
          values($a,:b,$c)", {'a': 1})</code> is perfectly valid (note
          <tt>b</tt> and <b>c</b> are not in the dict). For missing keys,
          None/NULL will be used. This is so you don't have to add lots of
          spurious values to the supplied dict. If your schema requires every
          column have a value, then SQLite will generate an error due to some
          values being None/NULL so that case will be caught.</p>
        </dd>

        <dt>ExecutionCompleteError</dt>

        <dd>
          <p>A statement is complete but you try to run it more anyway!</p>
        </dd>

        <dt>ExecTraceAbort</dt>

        <dd>
          <p>The <a href="#executiontracer">execution tracer</a> returned False
          so execution was aborted.</p>
        </dd>

        <dt>ExtensionLoadingError</dt>

        <dd>
          <p>An error happened loading an <a href=
          "http://www.sqlite.org/cvstrac/wiki/wiki?p=LoadableExtensions">extension</a>.</p>
        </dd>
      </dl>

      <p>The table lists which Exception classes correspond to which <a href=
      "http://www.sqlite.org/capi3ref.html#result-codes">SQLite error
      codes</a>. APSW runs with <a href=
      "http://www.sqlite.org/cvstrac/wiki?p=ExtendedResultCodes">extended
      result codes</a> turned on. If you get the <code>result</code> member of
      an exception instance then you will get the plain error code. The
      <code>extendedresult</code> member of an exception instance will get you
      the extended error code.</p>

      <blockquote>
        <!-- This is derived from exc_descriptors in the source -->

        <table cellpadding="5" cellspacing="5" border="0">
          <tr>
            <td valign="top">
              <table cellpadding="5" cellspacing="5" border="0" width="100%">
                <tr>
                  <th colspan="2">General Errors</th>
                </tr>

                <tr>
                  <td><code>SQLITE_ERROR</code></td>

                  <td>SQLError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_MISMATCH</code></td>

                  <td>MismatchError</td>
                </tr>

                <tr>
                  <td colspan="2">&nbsp;</td>
                </tr>

                <tr>
                  <th colspan="2">Internal Errors</th>
                </tr>

                <tr>
                  <td><code><i>SQLITE_INTERNAL</i></code></td>

                  <td>InternalError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_PROTOCOL</code></td>

                  <td>ProtocolError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_MISUSE</code></td>

                  <td>MisuseError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_RANGE</code></td>

                  <td>RangeError</td>
                </tr>

                <tr>
                  <td colspan="2">&nbsp;</td>
                </tr>

                <tr>
                  <th colspan="2">Permissions etc</th>
                </tr>

                <tr>
                  <td><code>SQLITE_PERM</code></td>

                  <td>PermissionsError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_READONLY</code></td>

                  <td>ReadOnlyError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_CANTOPEN</code></td>

                  <td>CantOpenError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_AUTH</code></td>

                  <td>AuthError</td>
                </tr>
              </table>
            </td>

            <td valign="top">
              <table cellpadding="5" cellspacing="5" border="0" width="100%">
                <tr>
                  <th colspan="2">Abort/Busy/etc</th>
                </tr>

                <tr>
                  <td><code>SQLITE_ABORT</code></td>

                  <td>AbortError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_BUSY</code></td>

                  <td>BusyError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_LOCKED</code></td>

                  <td>LockedError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_INTERRUPT</code></td>

                  <td>InterruptError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_SCHEMA</code></td>

                  <td>SchemaChangeError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_CONSTRAINT</code></td>

                  <td>ConstraintError</td>
                </tr>

                <tr>
                  <td colspan="2">&nbsp;</td>
                </tr>

                <tr>
                  <th colspan="2">Memory/Disk/etc</th>
                </tr>

                <tr>
                  <td><code>SQLITE_NOMEM</code></td>

                  <td>NoMemError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_IOERR</code></td>

                  <td>IOError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_CORRUPT</code></td>

                  <td>CorruptError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_FULL</code></td>

                  <td>FullError</td>
                </tr>

                <tr>
                  <td><code><i>SQLITE_TOOBIG</i></code></td>

                  <td>TooBigError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_NOLFS</code></td>

                  <td>NoLFSError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_EMPTY</code></td>

                  <td>EmptyError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_FORMAT</code></td>

                  <td>FormatError</td>
                </tr>

                <tr>
                  <td><code>SQLITE_NOTADB</code></td>

                  <td>NotADBError</td>
                </tr>
              </table>
            </td>
          </tr>
        </table>

        <p>Codes in <i>italics</i> are no longer used by SQLite (according to
        headers in 3.2.7).</p>
      </blockquote>

      <h2><a name="augmentedstacktraces" id="augmentedstacktraces">Augmented
      stack traces</a></h2>

      <p>When an exception occurs, Python does not include frames from
      non-Python code (ie the C code called from Python). This can make it more
      difficult to work out what was going on when an exception occurred for
      example when there are callbacks to collations, functions or virtual
      tables, triggers firing etc.</p>

      <p>This is an example showing the difference between the tracebacks you
      would have got with earlier versions of apsw and the augmented
      traceback.</p>

      <p><b>Code</b></p>
      <pre>
import apsw

def myfunc(x):
  1/0

con=apsw.Connection(":memory:")
con.createscalarfunction("foo", myfunc)
con.createscalarfunction("fam", myfunc)
cursor=con.cursor()
cursor.execute("create table bar(x,y,z);insert into bar values(1,2,3)")
cursor.execute("select foo(1) from bar")
</pre>

      <table cellpadding="3" cellspacing="3">
        <tr>
          <th>Original traceback</th>

          <th>Augmented traceback</th>
        </tr>

        <tr>
          <td valign="top">
            <pre>
Traceback (most recent call last):
  File "t.py", line 11, in &lt;module&gt;
    cursor.execute("select foo(1) from bar")
  File "t.py", line 4, in myfunc
    1/0
ZeroDivisionError: integer division or modulo by zero
</pre>
          </td>

          <td valign="top">
            <pre>
Traceback (most recent call last):
  File "t.py", line 11, in &lt;module&gt;
    cursor.execute("select foo(1) from bar")
  File "apsw.c", line 3412, in resetcursor
  File "apsw.c", line 1597, in user-defined-scalar-FOO
  File "t.py", line 4, in myfunc
    1/0
ZeroDivisionError: integer division or modulo by zero
</pre>
          </td>
        </tr>
      </table>

      <p>In the original traceback you can't even see that code in apsw was
      involved. The augmented traceback shows that there were indeed two
      function calls within apsw and gives you line numbers should you need to
      examine the code. Also note how you are told that the call was in
      <code>user-defined-scalar-FOO</code> (all function names are
      uppercased).</p>

      <p><i>But wait, there is more!!!</i> In order to further aid
      troubleshooting, the augmented stack traces make additional information
      available. Each frame in the traceback has local variables defined with
      more information. You can print out the variables using <a href=
      "http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/52215">ASPN
      recipe 52215</a>.</p>

      <blockquote>
        <p>In the recipe, the initial code in <code>print_exc_plus</code> is
        far more complicated than need be, and also won't work correctly with
        all tracebacks (it depends on f_prev being set which isn't always the
        case). Change the function to start like this:</p>

        <blockquote>
          <pre>
    tb = sys.exc_info()[2]
    stack = []
    
    while tb:
        stack.append(tb.tb_frame)
        tb = tb.tb_next

    traceback.print_exc()
    print "Locals by frame, innermost last"
</pre>
        </blockquote>
      </blockquote>

      <p>Here is a far more complex example from some <a href=
      "#VirtualTables">virtual tables</a> code I was writing. The BestIndex
      method in my code had returned an incorrect value. The augmented
      traceback includes local variables using recipe 52215. I can see what was
      passed in to my method, what I returned and which item was erroneous. The
      original traceback is almost completely useless.</p>

      <table cellpadding="3" cellspacing="3">
        <tr>
          <th>Original traceback</th>
        </tr>

        <tr>
          <td valign="top">
            <pre>
Traceback (most recent call last):
  File "tests.py", line 1387, in testVtables
    cursor.execute(allconstraints)
TypeError: Bad constraint (#2) - it should be one of None, an integer or a tuple of an integer and a boolean
</pre>
          </td>
        </tr>

        <tr>
          <th>Augmented traceback with local variables</th>
        </tr>

        <tr>
          <td valign="top">
            <pre>
Traceback (most recent call last):
  File "tests.py", line 1387, in testVtables
    cursor.execute(allconstraints)
                VTable =  __main__.VTable
                   cur =  &lt;apsw.Cursor object at 0x988f30&gt;
                     i =  10
                  self =  testVtables (__main__.APSW)
        allconstraints =  select rowid,* from foo where rowid&gt;-1000 ....

  File "apsw.c", line 4050, in Cursor_execute.sqlite3_prepare
            Connection =  &lt;apsw.Connection object at 0x978800&gt;
             statement =  select rowid,* from foo where rowid&gt;-1000 ....

  File "apsw.c", line 2681, in VirtualTable.xBestIndex
                  self =  &lt;__main__.VTable instance at 0x98d8c0&gt;
                  args =  (((-1, 4), (0, 32), (1, 8), (2, 4), (3, 64)), ((2, False),))
                result =  ([4, (3,), [2, False], [1], [0]], 997, u'\xea', False)

  File "apsw.c", line 2559, in VirtualTable.xBestIndex.result_constraint
               indices =  [4, (3,), [2, False], [1], [0]]
                  self =  &lt;__main__.VTable instance at 0x98d8c0&gt;
                result =  ([4, (3,), [2, False], [1], [0]], 997, u'\xea', False)
            constraint =  (3,)

TypeError: Bad constraint (#2) - it should be one of None, an integer or a tuple of an integer and a boolean
</pre>
          </td>
        </tr>
      </table>

      <h1><a name="Types" id="Types">Types</a></h1>

      <p>Read about <a href="http://www.sqlite.org/datatype3.html">SQLite 3
      types</a>. ASPW always maintains the correct type for values, and never
      converts them to something else. Note however that SQLite may convert
      types based on column affinity as described in that link. ASPW requires
      that all values supplied are one of the corresponding Python/SQLite types
      (or a subclass).</p>

      <ul>
        <li>
          <p>None in Python is NULL in SQLite</p>
        </li>

        <li>
          <p>Python int or long is INTEGER in SQLite. The value represented
          must fit within a 64 bit signed quantity (long long at the C level)
          or an exception is generated. (Don't worry - aspw only uses the long
          type when values are too large to fit in ints).</p>
        </li>

        <li>
          <p>Python's float type is used for REAL in SQLite. (At the C level
          they are both 8 byte quantities and there is no loss of
          precision).</p>
        </li>

        <li>
          <p>Python's string or unicode is used for TEXT in SQLite. (ASPW
          automatically uses Python's string type for ASCII text and Unicode
          for other text.)</p>
        </li>

        <li>
          <p>Python's buffer class is used for BLOB in SQLite.</p>
        </li>
      </ul>

      <h1><a name="Unicode" id="Unicode">Unicode</a></h1>

      <p>All SQLite strings are Unicode. The actual binary representations can
      be UTF8, or UTF16 in either byte order. ASPW uses the UTF8 interface to
      SQLite which results in the binary string representation in your database
      defaulting to UTF8 as well. All this is totally transparent to your
      Python code.</p>

      <p>Everywhere strings are used (eg as database values, SQL statements,
      bindings names, user defined functions) you can use Unicode strings. You
      can also use the bare Python string class, and ASPW will automatically
      call the unicode converter if any non-ascii characters are present.</p>

      <p>When reading values from SQLite, ASPW always uses the Python unicode class.</p>

      <h1><a name="threading" id="threading">Multi-threading and
      re-entrancy</a></h1>

      <p>ASPW lets you use SQLite in multi-threaded programs and will let other
      threads execute while SQLite is working. (Technically the <a href=
      "http://www.python.org/doc/2.3.4/api/threads.html">GIL</a> is released
      when <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_step">sqlite3_step</a> or
      <a href=
      "http://www.sqlite.org/capi3ref.html#sqlite3_open">sqlite3_open</a> are
      running. The GIL is re-acquired while user defined functions, collations
      and the various hooks/handlers run.)</p>

      <p>Note that you cannot use the same Connection object in multiple
      threads. You must allocate a new Connection object per thread. (This is a
      requirement of SQLite). A cursor object can only be used in the same
      thread as it was allocated. (Also an SQLite requirement). Fortunately
      ASPW will check this for you and throw a ThreadingViolationError if you
      try to use objects in the wrong thread. Note that your destructors also
      need to run in the creation thread.</p>

      <p>If you have multiple threads and/or multiple programs accessing the
      same database then there may be contention for the file. SQLite will
      return SQLITE_BUSY which will be raised as BusyError. You can call
      Connection.setbusytimeout to set how long SQLite will retry for or
      Connection.setbusyhandler to install your own busy handler. Note that
      SQLite won't call the busy handler or timeout if it believes a deadlock
      has arisen. SQLite's locking and concurrency is described <a href=
      "http://www.sqlite.org/lockingv3.html">here</a></p>

      <p>A cursor object can only be executing one query at a time. You cannot
      issue a new query from inside a trace function or from a user defined
      function or collation since these are called while executing a query. You
      can however make new cursors and use those without issue. You may want to
      remember the Connection object when you set your trace or user defined
      functions.</p>

      <h1><a name="tracers" id="tracers">Tracing</a></h1>

      <p>You can install tracers on a cursor as an easy way of seeing exactly
      what gets executed and what is returned. The tracers can also abort
      execution and cause different values to be returned. This is very useful
      for diagnostics and testing without having to modify your main code.</p>

      <p><b>Note</b>: You cannot issue new execute statements against the
      cursor your tracer was called from. If you would like to make more
      queries in the tracer then do them from a new cursor object.</p>

      <h2><a name="executiontracer" id="executiontracer">Execution
      Tracer</a></h2>

      <p>The execution tracer is called after an SQL statement has been
      prepared. (ie syntax errors will have caused an exception during
      preparation so you won't see them with a tracer). It is called with two
      arguments. The first is a string which is the SQL statement about to be
      executed, and the second is the bindings used for that statement (and can
      be None). If the return value evaluates to False/None then execution is
      aborted with an ExecTraceAbort exception. See the <a href=
      "#example-exectrace">example above</a>.</p>

      <h2><a name="rowtracer" id="rowtracer">Row Tracer</a></h2>

      <p>The row tracer is called before each row is returned. The arguments
      are the items about to be returned. Whatever you return from the tracer
      is what is actually returned. If you return None then the whole row is
      skipped. See the <a href="#example-rowtrace">example above</a>.</p>

      <h1><a name="64bitpy25">64 bit hosts, Python 2.5</a></h1>

      <p>Prior to Python 2.5, you were still limited to 32 bit quantities for
      items in Python such as the length of strings, number of items in a
      sequence etc. APSW will work correctly with those items in Python 2.5
      that use 64 bits. Unfortunately SQLite is limited to 32 bit quantities
      for strings, blobs, number of columns etc. Consequently you will get a
      TooBig exception from APSW which checks if strings/buffers longer than
      1GB or 2GB (depends on internal storage) are used. See SQLite ticket
      <a href="http://www.sqlite.org/cvstrac/tktview?tn=2125">2125</a>.</p>

      <h1><a name="executionmodel" id="executionmodel">Execution model</a></h1>

      <p>This section only matters if you give multiple SQL statements in one
      go to <code>cursor.execute()</code>. (Statements are seperated by
      semi-colons.)</p>

      <p>SQLite does execution in two steps. First a statement is prepared,
      which verifies the syntax, tables and fields and converts the statement
      into an internal representation. The prepared statement is then run.
      Execution stops when a row is available, there is an error or the
      statement is complete.</p>

      <p>The <code>cursor.execute()</code> method automatically does the
      preparing and starts execution. If none of the statements return rows
      then execution will go to the end. If a row is returned then you need to
      call cursor.next() to get the row values. Execution will resume as
      necessary to satisfy <code>next()</code> calls.</p>

      <p>However this means that if you don't read the rows returned then the
      rest of your statements won't be executed. APSW will detect unexecuted
      previous statements and generate an exception. For example:</p>

      <blockquote>
        <pre>
&gt;&gt;&gt; cursor.execute("select * from foo ; create table bar(x,y,z)")
&gt;&gt;&gt; cursor.execute("create table bam(x,y,z)")
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
apsw.IncompleteExecutionError: Error: there are still remaining sql statements to execute
</pre>
      </blockquote>

      <p>Because I didn't read the results of <code>select * from foo</code>
      then the following create table command didn't have a chance to get
      executed. On the next execute that condition is detected and an exception
      raised.</p>

      <h1><a name="dbapinotes" id="dbapinotes">DBAPI notes</a></h1>

      <p>DBAPI is defined in <a href=
      "http://www.python.org/peps/pep-0249.html">PEP 249</a>. This section
      desribes how APSW complies or differs from it.</p>

      <h2><a name="dbapimodiface" id="dbapimodiface">Module Interface</a></h2>

      <p>There is no connect method. Use the Connection constructor instead,
      which only takes one parameter - the name of the database.</p>

      <p>The Connection object and any cursors must all be used in the same
      thread they were allocated from. You cannot use them in different threads
      even if you protect them with mutexes.</p>

      <p>Three different paramstyles are supported. You can use qmark ('...
      WHERE name=?'), numeric ('... WHERE name=?4') and named ('... WHERE
      name=:name' or '... WHERE name=$name'). Note that SQLite numbers
      parameters from one not zero.</p>

      <p>The DBAPI exceptions are not used.</p>

      <h2><a name="dpapiconnectioniface" id="dpapiconnectioniface">Connection
      Objects</a></h2>

      <p>There are no commit or rollback methods. You should use
      cursor.execute("COMMIT") etc. The <a href=
      "http://www.sqlite.org/lockingv3.html">SQLite documentation</a> has more
      details.</p>

      <p>Several methods that are defined in DBAPI to be on the cursor are
      instead on the Connection object, since this is where SQLite actually
      stores the information. Doing operations in any other cursor attached to
      the same Connection object does update their values, and this makes you
      aware of that.</p>

      <h2><a name="dbapicursoriface" id="dbapicursoriface">Cursor
      Objects</a></h2>

      <p>Use getdescription() instead of description. This information is only
      obtained on request.</p>

      <p>There is no rowcount.</p>

      <p>callproc is not implemented as SQLite doesn't support stored
      procedures.</p>

      <p>execute returns the Cursor object and you can use it as an iterator to
      get the results (if any).</p>

      <p>executemany returns the Cursor object and you can use it as an
      iterator to get the results (if any).</p>

      <p>fetchone is not available. Use the cursor as an iterator, or call
      next() which raises StopIteration when there are no more results.</p>

      <p>fetchmany is not available. Call next() for however many results you
      want.</p>

      <p>fetchall is not available. Call next() or use a list comprehension
      such as <code>[row for row in cursor.execute("....")]</code>.</p>

      <p>nextset is not applicable or implemented.</p>

      <p>arraysize is not available as fetchmany isn't.</p>

      <p>Neither setinputsizes or setoutputsize are applicable or
      implemented.</p>

      <h2><a name="dpapitypes" id="dpapitypes">Type objects</a></h2>

      <p>None of the date or time methods are available since SQLite 3 does not
      have a native date or time type.</p>

      <p>Use the standard Python buffer class for BLOBs.</p>

      <h2><a name="dbapiextensions" id="dbapiextensions">Optional DB API
      Extensions</a></h2>

      <p>rownumber is not available.</p>

      <p>Exception classes are not available as attributes of Connection.</p>

      <p>Use Cursor.getconnection() to get the associated Connection
      object.</p>

      <p>scroll and messages are not available.</p>

      <p>The Cursor object supports the iterator protocol and this is the only
      way of getting information back.</p>

      <p>To get the last inserted row id, call
      <code>Connection.last_insert_rowid()</code>. That stores the id from the
      last insert on any Cursor associated with the the Connection. You can
      also add <code>select last_insert_rowid()</code> to the end of your
      execute statements.</p>

      <p>There is no errorhandler attribute.</p>

      <h1><a name="pysqlitediffs" id="pysqlitediffs">pysqlite
      differences</a></h1>

      <p><a href="http://pysqlite.org/">pysqlite</a> already provides a DBAPI
      compliant wrapper over SQLite 2 and 3. APSW only wraps SQLite 3. I
      suggest using APSW when you want to directly use SQLite and its
      functionality or are using your code to deal with database independence
      rather than DBAPI.</p>

      <p>APSW has the following enhancements/differences over pysqlite 2
      (wrapping SQLite 3):</p>

      <ul>
        <li>APSW gives all functionality of SQLite including <a href=
        "#VirtualTables">virtual tables</a></li>

        <li>APSW is a single file for the extension, apsw.pyd on Windows and
        apsw.so on Unix/Mac. There are no other files needed and the build
        instructions show you how to include SQLite statically in this file.
        You can put this file anywhere your Python session can reach. pysqlite
        is one binary file and several .py files, all of which need to be
        available.</li>

        <li>
          <p>*Nothing* happens behind your back. By default pysqlite tries to
          manage transactions by parsing your SQL for you, but you can turn it
          off. This can result in very unexpected behaviour with pysqlite.</p>
        </li>

        <li>
          <p>SQLite's Manifest typing is used, which limits values to being
          supplied as integer (32/64 bit), string (utf8/unicode), double,
          null/None and BLOB. (An exception happens if you don't supply values
          in one of the supported types.) APSW doesn't do any type conversion
          or co-ercion. Note that SQLite will under <a href=
          "http://www.sqlite.org/datatype3.html">some circumstances</a>.
          pysqlite does have a mechanism for <a href=
          "http://initd.org/pub/software/pysqlite/doc/usage-guide.html#using-adapters-to-store-additional-python-types-in-sqlite-databases">
          marshalling your own types</a> but you'll need to be careful if
          sharing the database with code in another language.</p>
        </li>

        <li>
          <p>APSW <b>always</b> handles Unicode correctly (this was one of the
          major reasons for writing it in the first place). pysqlite has since
          fixed many of its issues but you are still <a href=
          "http://initd.org/tracker/pysqlite/ticket/153">stuck with
          some</a>.</p>
        </li>

        <li>
          <p>You can use semi-colons at the end of commands and you can have
          multiple commands in the execute string in APSW. There are no
          restrictions on the type of commands used. For example this will work
          fine in APSW but is not allowed in pysqlite:</p>

          <blockquote>
            <pre>
import apsw 
con=apsw.Connection(":memory:") 
cur=con.cursor() 
for row in cur.execute("create table foo(x,y,z);insert into foo values (?,?,?);" 
                       "insert into foo values(?,?,?);select * from foo;drop table foo;" 
                       "create table bar(x,y);insert into bar values(?,?);" 
                       "insert into bar values(?,?);select * from bar;", 
                       (1,2,3,4,5,6,7,8,9,10)): 
                           print row
        
</pre>

            <p>And the output as you would expect:</p>
            <pre>
<b>$</b> python test.py 
(1, 2, 3) 
(4, 5, 6) 
(7, 8) 
(9, 10)
</pre>
          </blockquote>
        </li>

        <li>
          <p>The cursor object is an iterator and returns itself from execute.
          (The latest SQLite has now copied this feature).</p>
        </li>

        <li>
          <p><code>cursor.executemany()</code> also works with statements that
          return data such as selects, and you can have multiple
          statements.</p>
        </li>

        <li>pysqlite swallows exceptions in your callbacks making it far harder
        to debug problems. That also prevents you from raising exceptions in
        your callbacks to be handled in your code that called SQLite. pysqlite
        does let you turn on printing of tracebacks, but that is a poor
        substitute. apsw does the right thing as demonstrated by this example.

          <blockquote>
            <table border="1px" cellpadding="5" cellspacing="5">
              <tr>
                <th>pysqlite</th>

                <th>apsw</th>
              </tr>

              <tr>
                <td valign="top">
                  <pre>
from pysqlite2 import dbapi2 as sqlite
def badfunc(t):
    return 1/0

con = sqlite.connect(":memory:")
con.create_function("badfunc", 1, badfunc)
cur = con.cursor()
cur.execute("select badfunc(3)")
</pre>
                </td>

                <td valign="top">
                  <pre>
import apsw
def badfunc(t):
    return 1/0

con = apsw.Connection(":memory:")
con.createscalarfunction("badfunc", badfunc, 1)
cur = con.cursor()
cur.execute("select badfunc(3)")
</pre>
                </td>
              </tr>

              <tr>
                <td valign="top">
                  <pre>
C:\temp&gt;python func.py
Traceback (most recent call last):
  File "func.py", line 8, in ?
    cur.execute("select badfunc(3)")
pysqlite2.dbapi2.OperationalError: user-defined function raised exception
</pre>
                </td>

                <td valign="top">
                  <pre>
C:\temp&gt;python afunc.py
Traceback (most recent call last):
  File "t.py", line 8, in &lt;module&gt;
    cur.execute("select badfunc(3)")
  File "apsw.c", line 3660, in resetcursor
  File "apsw.c", line 1871, in user-defined-scalar-BADFUNC
  File "t.py", line 3, in badfunc
    return 1/0
</pre>
                </td>
              </tr>
            </table>
          </blockquote>
        </li>

        <li>APSW has enhanced debuggability. More details are available than
        just what is printed out when exceptions happen like above. See
        <a href="#augmentedstacktraces">augmented stack traces</a>. If you
        forget to close a Connection then you get a traceback of where the
        problem is (interceptable via <code>sys.excepthook</code>) and are also
        told where Connection was allocated.</li>

        <li>
          <p>You can implement tracers and other hooks in Python.</p>
        </li>

        <li>
          <p>The APSW test suite is larger and tests more functionality. Code
          coverage by the test suite is 94%. pysqlite is good at 81% for C code
          although there are several places that coverage can be improved. I
          haven't measured code coverage for pysqlite's Python code.</p>

          <p>In both cases, some of the non-covered code lines require that the
          Python interpretter or SQLite run out of memory so 100% coverage
          isn't possible.</p>
        </li>
      </ul>

      <h1><a name="copyrightlicense" id="copyrightlicense">Copyright and
      License</a></h1>

      <p>Copyright (C) 2004-2007 Roger Binns <a href=
      "mailto:rogerb@rogerbinns.com">rogerb@rogerbinns.com</a></p>

      <p>This software is provided 'as-is', without any express or implied
      warranty. In no event will the authors be held liable for any damages
      arising from the use of this software.</p>

      <p>Permission is granted to anyone to use this software for any purpose,
      including commercial applications, and to alter it and redistribute it
      freely, subject to the following restrictions:</p>

      <blockquote>
        <ol>
          <li>
            <p>The origin of this software must not be misrepresented; you must
            not claim that you wrote the original software. If you use this
            software in a product, an acknowledgment in the product
            documentation would be appreciated but is not required.</p>
          </li>

          <li>
            <p>Altered source versions must be plainly marked as such, and must
            not be misrepresented as being the original software.</p>
          </li>

          <li>
            <p>This notice may not be removed or altered from any source
            distribution.</p>
          </li>
        </ol>
      </blockquote>

      <h1><a name="verhistory" id="verhistory">Version History</a></h1>

      <h2><a name="341r1">3.4.1-r1</a></h2>

      <p>You can use this with SQLite 3.4.1 onwards.

      <p>SQLite now provides the source all <a
      href="http://www.sqlite.org/cvstrac/wiki?p=TheAmalgamation">amalgamated</a>
      into one file which improves performance and makes compilation
      and linking of SQLite far easier.  The build instructions are updated.

      <ul>
        <li>SQLITE_COPY authorizer code and SQLITE_PROTOCOL error code are no longer used by SQLite, but the values are left in
            apsw for backwards compatibility
        <li>SQLITE_IOERR_DELETE and SQLITE_IOERR_BLOCKED added
        <li>Connection.interrupt can be called from any thread
        <li>SQLite has added <a href="http://www.sqlite.org/limits.html">limits checking</a> (roughly speaking upper bounds are 32 bit signed values
even on 64 bit machines).  apsw has had checks for a while due to the SQLite apis taking 32 bit values even under a 64 bit compilation.  The additional SQLite checks now make it impossible to go beyond intended limits.  The SQLITE_TOOBIG error had ben deprecated by SQLite and was resurrected in this release.
<li>
        <li>A rename method was added for virtual tables.
        <li>SQLite 3.4.1 introduced a new virtual table registration function, but it is marked as highly experimental and hence hasn't been used until we see what happens to it in the next SQLite release.
</ul>


        


      <h2><a name="3313r1">3.3.13-r1</a></h2>

      <p>As of this release, APSW is now co-hosted with pysqlite meaning there
      is one site to go to for your Python SQLite bindings. Start at <a href=
      "http://initd.org/tracker/pysqlite/wiki/">http://initd.org/tracker/pysqlite/wiki</a></p>

      <p>You can use this with SQLite 3.3.13 onwards. There were no API changes
      in SQLite 3.3.10 to 3.3.13 although some internal bugs were fixed and the
      3.3.13 release is recommended over the earlier version.</p>

      <p>Thanks to Ed Pasma for highlighting these issues.</p>

      <ul>
        <li><tt>Connection.interrupt</tt> can be safely called from any
        thread.</li>

        <li>Empty statements or those consisting entirely of whitespace do not
        cause misuse errors (internally SQLite started returned NULL pointers
        for those statements, and sqlite3_step didn't like being passed the
        NULL pointer).</li>

        <li>Changed special handling of SQLITE_BUSY error to be the same as
        other errors. The special handling previously let you restart on
        receiving busy, but also hung onto statements which could result in
        other statements getting busy errors.</li>
      </ul>

      <h2><a name="3310r1">3.3.10-r1</a></h2>

      <p>You can use this with SQLite 3.3.10 onwards.</p>

      <ul>
        <li>Added a statement cache that works in conjunction with the
        sqlite3_prepare_v2 API. A few issues were exposed in SQLite and hence
        you must use SQLite 3.3.10 or later.</li>
      </ul>

      <h2><a name="339r1">3.3.9-r1</a></h2>

      <p>You can use this with SQLite 3.3.9 onwards.</p>

      <ul>
        <li>SQLite added <a href=
        "http://sqlite.org/capi3ref.html#sqlite3_prepare_v2">sqlite3_prepare_v2</a>
        API. The net effect of this API update is that you will not get
        SQLITE_SCHEMA any more. SQLite will handle it internally.</li>
      </ul>

      <h2><a name="338r1">3.3.8-r1</a></h2>

      <p>You can use this with SQLite 3.3.8 onwards. There was an incompatible
      API change for virtual tables in SQLite 3.3.8.</p>

      <ul>
        <li>Virtual tables updated for new api</li>

        <li>You must call close() on connections. You can also call close on
        cursors, but it usually isn't necessary.</li>

        <li>All strings are returned as unicode</li>

        <li>PyErr_WriteUnraisable was used for errors in destructors.
        Unfortunately it is almost completely useless, merely printing str() of
        the object and exception. This doesn't help in finding where in your
        code the issue arose so you could fix it. An internal APSW
        implementation generates a traceback and calls
        <code>sys.excepthook</code>, the default implementation of which prints
        the exception and the traceback to sys.stderr. <b>Note</b> the line
        number reported in the traceback is often off by 1. This is because the
        destructors run "between" lines of code and so the following line is
        reported as the current location.</li>

        <li>Authorizer codes SQLITE_CREATE_VTABLE, SQLITE_DROP_VTABLE and
        SQLITE_FUNCTION added.</li>

        <li>SQLite <a href=
        "http://www.sqlite.org/cvstrac/wiki?p=ExtendedResultCodes">extended
        result codes</a> are available - see <a href=
        "#Exceptions">Exceptions</a> for more detail.</li>

        <li><a href="#Module_variables">Connection hooks</a> added so you can
        easily register functions, virtual tables or similar items with each
        Connection as it is created.</li>

        <li>Added <a href="#Module_constants">mapping dicts</a> which makes it
        easy to map the various constants between strings and ints.</li>
      </ul>

      <h2><a name="337r1">3.3.7-r1</a></h2>

      <p><i>Never released as 3.3.8 came along</i></p>

      <p>You can use this release against SQLite 3.3.7. There were no changes
      in the SQLite 3.3.6 API from 3.3.5. In SQLite 3.3.7 an API was added that
      allowed removing a chunk of duplicate code. Also added were <a href=
      "http://www.sqlite.org/cvstrac/wiki?p=VirtualTables">Virtual Tables</a>
      and loading of external modules (shared libraries). APSW had the
      following changes:</p>

      <ul>
        <li>Even more test cases added (you can't have too many tests :-)</li>

        <li>When exceptions occur, dummy frames are added to the traceback in
        the C code. This makes it a lot easier to tell why code was called if
        you encounter an exception. See <a href=
        "#augmentedstacktraces">augmented stack traces</a> for details.</li>

        <li>String values (traditional and Unicode) work correctly if they have
        embedded NULL characters (ie not truncated at the NULL).</li>

        <li>You can load SQLite shared library extensions.</li>
      </ul>

      <h2><a name="335r1">3.3.5-r1</a></h2>

      <p>You can use this release against any release of SQLite 3 from 3.3.5
      onwards. A bug was also fixed when reporting an error during the cleanup
      of an aggregate function if there had also been an error in the step
      function. (PyErr_WriteUnraisable(NULL) crashed on some versions of Python
      but not others.)</p>

      <p>SQLite added several functions for returning metadata about result
      column sets. You have to compile SQLite with
      <tt>SQLITE_ENABLE_COLUMN_METADATA</tt> to get them. This is not the
      default for SQLite. I don't believe these are generally useful except in
      some corner cases and so they aren't wrapped. However please shout if you
      do need them. Note that <tt>cursor.getdescription</tt> will already give
      you generally useful information. (Also see the <a href=
      "http://sqlite.org/pragma.html">pragmas</a>).</p>

      <p>The test code has been converted into using the unittest module. Run
      <tt>python tests.py -v</tt> to get the tests run. There should be no
      errors.</p>

      <p>Updated code to work correctly with new Py_ssize_t introduced in
      Python 2.5. See <a href="#64bitpy25">64 bit hosts, Python 2.5</a> for
      more details on how Python and SQLite handle 64 bit sized items.</p>

      <p>The following functions were added to SQLite and are wrapped. They are
      all functions defined on the <a href="#Connection">Connection</a>
      object.</p>

      <ul>
        <li><a href=
        "http://sqlite.org/capi3ref.html#sqlite3_update_hook">sqlite3_update_hook</a></li>

        <li><a href=
        "http://sqlite.org/capi3ref.html#sqlite3_rollback_hook">sqlite3_rollback_hook</a></li>

        <li><a href=
        "http://sqlite.org/capi3ref.html#sqlite3_enable_shared_cache">sqlite3_enable_shared_cache</a>
        (Module level method)</li>

        <li><a href=
        "http://sqlite.org/capi3ref.html#sqlite3_get_autocommit">sqlite3_get_autocommit</a>
        (Connection level method)</li>

        <li>sqlite3_profile (experimental, not documented on SQLite site) This
        callback is run at the end of each statement execution telling you how
        long it took)</li>
      </ul>

      <p>The following functions were added/changed in SQLite C API but are not
      useful to be wrapped.</p>

      <ul>
        <li>sqlite3_value_numeric_type (query if a result is numeric)</li>

        <li><a href=
        "http://sqlite.org/capi3ref.html#sqlite3_global_recover">sqlite3_global_recover</a>
        (already deprecated)</li>

        <li><a href=
        "http://sqlite.org/capi3ref.html#sqlite3_release_memory">sqlite3_release_memory</a>
        (requires non-default compile flag)</li>

        <li><a href=
        "http://sqlite.org/capi3ref.html#sqlite3_soft_heap_limit">sqlite3_soft_heap_limit</a>
        (requires non-default compile flag)</li>

        <li><a href=
        "http://sqlite.org/capi3ref.html#sqlite3_db_handle">sqlite3_db_handle</a>
        (use cursor.getconnection())</li>
      </ul>

      <h2><a name="327r1">3.2.7-r1</a></h2>

      <p>You can use this release against any release of SQLite 3.</p>

      <p>SQLite 3.2.7 has several bug fixes. The undocumented experimental
      function <code>sqlite3_profile</code> was added, but it not present in
      apsw yet.</p>

      <ul>
        <li>The author of pysqlite has improved it considerably since APSW was
        originally written. The differences section has been updated to reflect
        those improvements in pysqlite.</li>

        <li>SQLITE_INTERNAL and SQLITE_NOTFOUND error codes are not used
        according to 3.2.7 header file. They are still present in APSW for
        backwards compatibility.</li>

        <li>Changed the build instructions so configure is run on non-Windows
        platforms.</li>

        <li>Fixed a bug caused by an overly helpful error message trying to
        tell you how many bindings you supplied that crashed if you didn't
        supply any.</li>

        <li>Changed when an error in the step function for an aggregate is
        reported due to limitations in SQLite.</li>
      </ul>

      <h2><a name="322r1">3.2.2-r1</a></h2>

      <p>You can use this release against any release of SQLite 3.</p>

      <p>SQLite 3.2.2 API removed <code>sqlite3_global_recover</code>. That
      function was not wrapped in APSW. Note that SQLite 3.2.2 contains a bug
      fix that applies when you use 64 bit integer primary keys (32 bit ints
      are fine).</p>

      <h2><a name="321r1">3.2.1-r1</a></h2>

      <p>You can use this release against any release of SQLite 3.</p>

      <ul>
        <li>There are no changes in APSW except to correct an error in the
        example code (collations are registered against the connection not the
        cursor)</li>
      </ul>

      <p>SQLite 3.2.1 had one addition in the stable C API, which was a new
      function named <code>sqlite3_global_recover</code>. That function is not
      applicable for wrapping in APSW.</p>

      <h2><a name="313r1">3.1.3-r1</a></h2>

      <p>You can use this release against any release of SQLite 3.</p>

      <ul>
        <li>The text string returned by apsw.Error used to say
        "apsw.APSWException" and has been changed to "apsw.Error". This is
        purely cosmetic and helps make clear what the class is. (The old string
        was what the original class name was in an earlier version of the
        code.)</li>

        <li>Added <code>SQLITE_ALTER_TABLE</code> and
        <code>SQLITE_REINDEX</code> constants for the authorizer function.
        (These constants were introduced in SQLite 3.1.3).</li>

        <li>Changed various C++-isms into standard C (eg // comments and the
        placing of some CHECK_THREAD macro calls)</li>

        <li>Added module level function <code>apswversion</code> which returns
        the version of APSW.</li>
      </ul>

      <p>SQLite 3.1.3 had no changes in the stable C API other than what is
      mentioned above. There were some new experimental functions added which
      are not currently documented on the SQLite website, which are not wrapped
      by APSW. Please contact me if you believe they will remain in SQLite and
      you would like them wrapped:</p>

      <ul>
        <li><code>sqlite3_sleep</code> An alternative function which sleeps for
        a specified number of milliseconds can be provided. By default SQLite
        just uses the standard operating system call.</li>

        <li><code>sqlite3_expired</code> This function is internal to statement
        execution. It would apply to the implementation of Cursor.executemany
        and could in theory provide a marginal improvement in performance.</li>

        <li>A global variable <code>sqlite3_temp_directory</code> can be used
        before any databases are opened to set where temporary files are
        created. By default SQLite just uses the standard operating system
        mechanisms.</li>
      </ul>

      <h2><a name="308r3">3.0.8-r3</a></h2>

      <p>There are no functional changes. The only changes were to correct some
      variable names in the example code (they were cut and pasted from the
      test code which used different names) and to make the source zip file
      extract its contents into a sub-directory which is the more typical way
      of packaging that sort of thing.</p>

      <h2><a name="308r2">3.0.8-r2</a></h2>

      <p>All remaining functionality in the C API for SQLite 3.0.8 is now
      available.</p>

      <p>Finished this documentation.</p>

      <h2><a name="308r1">3.0.8-r1</a></h2>

      <p>Initial release</p>
      <hr />
    </dd>
  </dl>
</body>
</html>
